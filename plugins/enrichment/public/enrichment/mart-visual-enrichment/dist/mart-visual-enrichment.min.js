!function(){var e,n,r,t;!function(){var o={},i={};e=function(e,n,r){o[e]={deps:n,callback:r}},t=r=n=function(e){function r(n){if("."!==n.charAt(0))return n;for(var r=n.split("/"),t=e.split("/").slice(0,-1),o=0,i=r.length;i>o;o++){var a=r[o];if(".."===a)t.pop();else{if("."===a)continue;t.push(a)}}return t.join("/")}if(t._eak_seen=o,i[e])return i[e];if(i[e]={},!o[e])throw new Error("Could not find module "+e);for(var a,u=o[e],c=u.deps,s=u.callback,f=[],l=0,d=c.length;d>l;l++)f.push("exports"===c[l]?a={}:n(r(c[l])));var h=s.apply(this,f);return i[e]=a||h}}(),e("promise/all",["./utils","exports"],function(e,n){"use strict";function r(e){var n=this;if(!t(e))throw new TypeError("You must pass an array to all.");return new n(function(n,r){function t(e){return function(n){i(e,n)}}function i(e,r){u[e]=r,0===--c&&n(u)}var a,u=[],c=e.length;0===c&&n([]);for(var s=0;s<e.length;s++)a=e[s],a&&o(a.then)?a.then(t(s),r):i(s,a)})}var t=e.isArray,o=e.isFunction;n.all=r}),e("promise/asap",["exports"],function(e){"use strict";function n(){return function(){process.nextTick(o)}}function r(){var e=0,n=new c(o),r=document.createTextNode("");return n.observe(r,{characterData:!0}),function(){r.data=e=++e%2}}function t(){return function(){s.setTimeout(o,1)}}function o(){for(var e=0;e<f.length;e++){var n=f[e],r=n[0],t=n[1];r(t)}f=[]}function i(e,n){var r=f.push([e,n]);1===r&&a()}var a,u="undefined"!=typeof window?window:{},c=u.MutationObserver||u.WebKitMutationObserver,s="undefined"!=typeof global?global:this,f=[];a="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?n():c?r():t(),e.asap=i}),e("promise/cast",["exports"],function(e){"use strict";function n(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var n=this;return new n(function(n){n(e)})}e.cast=n}),e("promise/config",["exports"],function(e){"use strict";function n(e,n){return 2!==arguments.length?r[e]:void(r[e]=n)}var r={instrument:!1};e.config=r,e.configure=n}),e("promise/polyfill",["./promise","./utils","exports"],function(e,n,r){"use strict";function t(){var e="Promise"in window&&"cast"in window.Promise&&"resolve"in window.Promise&&"reject"in window.Promise&&"all"in window.Promise&&"race"in window.Promise&&function(){var e;return new window.Promise(function(n){e=n}),i(e)}();e||(window.Promise=o)}var o=e.Promise,i=n.isFunction;r.polyfill=t}),e("promise/promise",["./config","./utils","./cast","./all","./race","./resolve","./reject","./asap","exports"],function(e,n,r,t,o,i,a,u,c){"use strict";function s(e){if(!S(e))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof s))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._subscribers=[],f(e,this)}function f(e,n){function r(e){y(n,e)}function t(e){m(n,e)}try{e(r,t)}catch(o){t(o)}}function l(e,n,r,t){var o,i,a,u,c=S(r);if(c)try{o=r(t),a=!0}catch(s){u=!0,i=s}else o=t,a=!0;v(n,o)||(c&&a?y(n,o):u?m(n,i):e===D?y(n,o):e===k&&m(n,o))}function d(e,n,r,t){var o=e._subscribers,i=o.length;o[i]=n,o[i+D]=r,o[i+k]=t}function h(e,n){for(var r,t,o=e._subscribers,i=e._detail,a=0;a<o.length;a+=3)r=o[a],t=o[a+n],l(n,r,t,i);e._subscribers=null}function v(e,n){var r,t=null;try{if(e===n)throw new TypeError("A promises callback cannot return that same promise.");if(A(n)&&(t=n.then,S(t)))return t.call(n,function(t){return r?!0:(r=!0,void(n!==t?y(e,t):w(e,t)))},function(n){return r?!0:(r=!0,void m(e,n))}),!0}catch(o){return r?!0:(m(e,o),!0)}return!1}function y(e,n){e===n?w(e,n):v(e,n)||w(e,n)}function w(e,n){e._state===B&&(e._state=O,e._detail=n,b.async(p,e))}function m(e,n){e._state===B&&(e._state=O,e._detail=n,b.async(g,e))}function p(e){h(e,e._state=D)}function g(e){h(e,e._state=k)}var b=e.config,A=(e.configure,n.objectOrFunction),S=n.isFunction,E=(n.now,r.cast),j=t.all,x=o.race,_=i.resolve,I=a.reject,N=u.asap;b.async=N;var B=void 0,O=0,D=1,k=2;s.prototype={constructor:s,_state:void 0,_detail:void 0,_subscribers:void 0,then:function(e,n){var r=this,t=new this.constructor(function(){});if(this._state){var o=arguments;b.async(function(){l(r._state,t,o[r._state-1],r._detail)})}else d(this,t,e,n);return t},"catch":function(e){return this.then(null,e)}},s.all=j,s.cast=E,s.race=x,s.resolve=_,s.reject=I,c.Promise=s}),e("promise/race",["./utils","exports"],function(e,n){"use strict";function r(e){var n=this;if(!t(e))throw new TypeError("You must pass an array to race.");return new n(function(n,r){for(var t,o=0;o<e.length;o++)t=e[o],t&&"function"==typeof t.then?t.then(n,r):n(t)})}var t=e.isArray;n.race=r}),e("promise/reject",["exports"],function(e){"use strict";function n(e){var n=this;return new n(function(n,r){r(e)})}e.reject=n}),e("promise/resolve",["exports"],function(e){"use strict";function n(e){var n=this;return new n(function(n){n(e)})}e.resolve=n}),e("promise/utils",["exports"],function(e){"use strict";function n(e){return r(e)||"object"==typeof e&&null!==e}function r(e){return"function"==typeof e}function t(e){return"[object Array]"===Object.prototype.toString.call(e)}var o=Date.now||function(){return(new Date).getTime()};e.objectOrFunction=n,e.isFunction=r,e.isArray=t,e.now=o}),n("promise/polyfill").polyfill()}(),function(){"use strict";function e(e){if(e)for(var n in s)void 0!==e[n]&&(s[n]=e[n]);return new u(function(e,n){var r=f.open(s.name,s.version);r.onerror=function(){n(r.error.name)},r.onupgradeneeded=function(){r.result.createObjectStore(s.storeName)},r.onsuccess=function(){c=r.result,e()}})}function n(e,n){var r=this;return new u(function(t,o){r.ready().then(function(){var r=c.transaction(s.storeName,"readonly").objectStore(s.storeName),i=r.get(e);i.onsuccess=function(){var e=i.result;void 0===e&&(e=null),n&&n(e),t(e)},i.onerror=function(){o(i.error.name)}})})}function r(e,n,r){var t=this;return new u(function(o,i){t.ready().then(function(){var t=c.transaction(s.storeName,"readwrite").objectStore(s.storeName);void 0===n&&(n=null);var a=t.put(n,e);a.onsuccess=function(){r&&r(n),o(n)},a.onerror=function(){i(a.error.name)}})})}function t(e,n){var r=this;return new u(function(t,o){r.ready().then(function(){var r=c.transaction(s.storeName,"readwrite").objectStore(s.storeName),i=r["delete"](e);i.onsuccess=function(){n&&n(),t()},i.onerror=function(){o(i.error.name)}})})}function o(e){var n=this;return new u(function(r,t){n.ready().then(function(){var n=c.transaction(s.storeName,"readwrite").objectStore(s.storeName),o=n.clear();o.onsuccess=function(){e&&e(),r()},o.onerror=function(){t(o.error.name)}})})}function i(e){var n=this;return new u(function(r,t){n.ready().then(function(){var n=c.transaction(s.storeName,"readonly").objectStore(s.storeName),o=n.count();o.onsuccess=function(){e&&e(o.result),r(o.result)},o.onerror=function(){t(o.error.name)}})})}function a(e,n){var r=this;return new u(function(t,o){return 0>e?(n&&n(null),void t(null)):void r.ready().then(function(){var r=c.transaction(s.storeName,"readonly").objectStore(s.storeName),i=!1,a=r.openCursor();a.onsuccess=function(){var r=a.result;return r?void(0===e?(n&&n(r.key),t(r.key)):i?(n&&n(r.key),t(r.key)):(i=!0,r.advance(e))):(n&&n(null),void t(null))},a.onerror=function(){o(a.error.name)}})})}var u=this.Promise,c=null,s={name:"localforage",storeName:"keyvaluepairs",version:1},f=f||this.indexedDB||this.webkitIndexedDB||this.mozIndexedDB||this.OIndexedDB||this.msIndexedDB;if(f){var l={_driver:"asyncStorage",_initStorage:e,getItem:n,setItem:r,removeItem:t,clear:o,length:i,key:a};"function"==typeof define&&define.amd?define("asyncStorage",function(){return l}):"undefined"!=typeof module&&module.exports?module.exports=l:this.asyncStorage=l}}.call(this),function(){"use strict";function e(e){if(e)for(var n in l)void 0!==e[n]&&(l[n]=e[n]);return f=l.name+"/",d.resolve()}function n(e){var n=this;return new d(function(r){n.ready().then(function(){h.clear(),e&&e(),r()})})}function r(e,n){var r=this;return new d(function(t,o){r.ready().then(function(){try{var r=h.getItem(f+e);r&&(r=a(r)),n&&n(r),t(r)}catch(i){o(i)}})})}function t(e,n){var r=this;return new d(function(t){r.ready().then(function(){var r=h.key(e);r&&(r=r.substring(f.length)),n&&n(r),t(r)})})}function o(e){var n=this;return new d(function(r){n.ready().then(function(){var n=h.length;e&&e(n),r(n)})})}function i(e,n){var r=this;return new d(function(t){r.ready().then(function(){h.removeItem(f+e),n&&n(),t()})})}function a(e){if(e.substring(0,w)!==y)return JSON.parse(e);for(var n=e.substring(N),r=e.substring(w,N),t=new ArrayBuffer(2*n.length),o=new Uint16Array(t),i=n.length-1;i>=0;i--)o[i]=n.charCodeAt(i);switch(r){case m:return t;case p:return new Blob([t]);case g:return new Int8Array(t);case b:return new Uint8Array(t);case A:return new Uint8ClampedArray(t);case S:return new Int16Array(t);case j:return new Uint16Array(t);case E:return new Int32Array(t);case x:return new Uint32Array(t);case _:return new Float32Array(t);case I:return new Float64Array(t);default:throw new Error("Unkown type: "+r)}}function u(e){var n="",r=new Uint16Array(e);try{n=String.fromCharCode.apply(null,r)}catch(t){for(var o=0;o<r.length;o++)n+=String.fromCharCode(r[o])}return n}function c(e,n){var r="";if(e&&(r=e.toString()),e&&("[object ArrayBuffer]"===e.toString()||e.buffer&&"[object ArrayBuffer]"===e.buffer.toString())){var t,o=y;e instanceof ArrayBuffer?(t=e,o+=m):(t=e.buffer,"[object Int8Array]"===r?o+=g:"[object Uint8Array]"===r?o+=b:"[object Uint8ClampedArray]"===r?o+=A:"[object Int16Array]"===r?o+=S:"[object Uint16Array]"===r?o+=j:"[object Int32Array]"===r?o+=E:"[object Uint32Array]"===r?o+=x:"[object Float32Array]"===r?o+=_:"[object Float64Array]"===r?o+=I:n(new Error("Failed to get type for BinaryArray")));var i=u(t);n(null,o+i)}else if("[object Blob]"===r){var a=new FileReader;a.onload=function(){var e=u(this.result);n(null,y+p+e)},a.readAsArrayBuffer(e)}else try{n(null,JSON.stringify(e))}catch(c){window.console&&window.console.error&&window.console.error("Couldn't convert value into a JSON string: ",e),n(c)}}function s(e,n,r){var t=this;return new d(function(o,i){t.ready().then(function(){void 0===n&&(n=null);var t=n;c(n,function(n,a){n?i(n):(h.setItem(f+e,a),r&&r(t),o(t))})})})}var f="",l={name:"localforage"},d=this.Promise,h=null;try{h=this.sessionStorage}catch(v){return}var y="__lfsc__:",w=y.length,m="arbf",p="blob",g="si08",b="ui08",A="uic8",S="si16",E="si32",j="ur16",x="ui32",_="fl32",I="fl64",N=w+m.length,B={_driver:"localStorageWrapper",_initStorage:e,getItem:r,setItem:s,removeItem:i,clear:n,length:o,key:t};"function"==typeof define&&define.amd?define("localStorageWrapper",function(){return B}):"undefined"!=typeof module&&module.exports?module.exports=B:this.localStorageWrapper=B}.call(this),function(){"use strict";function e(e){if(e)for(var n in v)void 0!==e[n]&&(v[n]="string"!=typeof e[n]?e[n].toString():e[n]);return new l(function(e){h=d(v.name,v.version,v.description,v.size),h.transaction(function(n){n.executeSql("CREATE TABLE IF NOT EXISTS "+v.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],function(){e()},null)})})}function n(e,n){var r=this;return new l(function(t){r.ready().then(function(){h.transaction(function(r){r.executeSql("SELECT * FROM "+v.storeName+" WHERE key = ? LIMIT 1",[e],function(e,r){var o=r.rows.length?r.rows.item(0).value:null;o&&(o=c(o)),n&&n(o),t(o)},null)})})})}function r(e,n,r){var t=this;return new l(function(o,i){t.ready().then(function(){void 0===n&&(n=null);var t=n;s(n,function(n,a){n?i(n):h.transaction(function(n){n.executeSql("INSERT OR REPLACE INTO "+v.storeName+" (key, value) VALUES (?, ?)",[e,a],function(){r&&r(t),o(t)},null)})})})})}function t(e,n){var r=this;return new l(function(t){r.ready().then(function(){h.transaction(function(r){r.executeSql("DELETE FROM "+v.storeName+" WHERE key = ?",[e],function(){n&&n(),t()},null)})})})}function o(e){var n=this;return new l(function(r){n.ready().then(function(){h.transaction(function(n){n.executeSql("DELETE FROM "+v.storeName,[],function(){e&&e(),r()},null)})})})}function i(e){var n=this;return new l(function(r){n.ready().then(function(){h.transaction(function(n){n.executeSql("SELECT COUNT(key) as c FROM "+v.storeName,[],function(n,t){var o=t.rows.item(0).c;e&&e(o),r(o)},null)})})})}function a(e,n){var r=this;return new l(function(t){r.ready().then(function(){h.transaction(function(r){r.executeSql("SELECT key FROM "+v.storeName+" WHERE id = ? LIMIT 1",[e+1],function(e,r){var o=r.rows.length?r.rows.item(0).key:null;n&&n(o),t(o)},null)})})})}function u(e){var n,r=new Uint8Array(e),t="";for(n=0;n<r.length;n+=3)t+=f[r[n]>>2],t+=f[(3&r[n])<<4|r[n+1]>>4],t+=f[(15&r[n+1])<<2|r[n+2]>>6],t+=f[63&r[n+2]];return r.length%3===2?t=t.substring(0,t.length-1)+"=":r.length%3===1&&(t=t.substring(0,t.length-2)+"=="),t}function c(e){if(e.substring(0,w)!==y)return JSON.parse(e);var n,r,t,o,i,a=e.substring(N),u=e.substring(w,N),c=.75*a.length,s=a.length,l=0;"="===a[a.length-1]&&(c--,"="===a[a.length-2]&&c--);var d=new ArrayBuffer(c),h=new Uint8Array(d);for(n=0;s>n;n+=4)r=f.indexOf(a[n]),t=f.indexOf(a[n+1]),o=f.indexOf(a[n+2]),i=f.indexOf(a[n+3]),h[l++]=r<<2|t>>4,h[l++]=(15&t)<<4|o>>2,h[l++]=(3&o)<<6|63&i;switch(u){case m:return d;case p:return new Blob([d]);case g:return new Int8Array(d);case b:return new Uint8Array(d);case A:return new Uint8ClampedArray(d);case S:return new Int16Array(d);case j:return new Uint16Array(d);case E:return new Int32Array(d);case x:return new Uint32Array(d);case _:return new Float32Array(d);case I:return new Float64Array(d);default:throw new Error("Unkown type: "+u)}}function s(e,n){var r="";if(e&&(r=e.toString()),e&&("[object ArrayBuffer]"===e.toString()||e.buffer&&"[object ArrayBuffer]"===e.buffer.toString())){var t,o=y;e instanceof ArrayBuffer?(t=e,o+=m):(t=e.buffer,"[object Int8Array]"===r?o+=g:"[object Uint8Array]"===r?o+=b:"[object Uint8ClampedArray]"===r?o+=A:"[object Int16Array]"===r?o+=S:"[object Uint16Array]"===r?o+=j:"[object Int32Array]"===r?o+=E:"[object Uint32Array]"===r?o+=x:"[object Float32Array]"===r?o+=_:"[object Float64Array]"===r?o+=I:n(new Error("Failed to get type for BinaryArray")));var i=u(t);n(null,o+i)}else if("[object Blob]"===r){var a=new FileReader;a.onload=function(){var e=u(this.result);n(null,y+p+e)},a.readAsArrayBuffer(e)}else try{n(null,JSON.stringify(e))}catch(c){window.console&&window.console.error&&window.console.error("Couldn't convert value into a JSON string: ",e),n(c)}}var f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l=this.Promise,d=this.openDatabase,h=null,v={description:"",name:"localforage",size:4980736,storeName:"keyvaluepairs",version:"1.0"},y="__lfsc__:",w=y.length,m="arbf",p="blob",g="si08",b="ui08",A="uic8",S="si16",E="si32",j="ur16",x="ui32",_="fl32",I="fl64",N=w+m.length;if(d){var B={_driver:"webSQLStorage",_initStorage:e,getItem:n,setItem:r,removeItem:t,clear:o,length:i,key:a};"function"==typeof define&&define.amd?define("webSQLStorage",function(){return B}):"undefined"!=typeof module&&module.exports?module.exports=B:this.webSQLStorage=B}}.call(this),function(){"use strict";var e=this.Promise,n=1,r=2,t=3,o=t;"function"==typeof define&&define.amd?o=n:"undefined"!=typeof module&&module.exports&&(o=r);var i,a=a||this.indexedDB||this.webkitIndexedDB||this.mozIndexedDB||this.OIndexedDB||this.msIndexedDB,u=this.openDatabase,c=this,s={INDEXEDDB:"asyncStorage",LOCALSTORAGE:"localStorageWrapper",WEBSQL:"webSQLStorage",config:{},driver:function(){return this._driver||null},_ready:e.reject(new Error("setDriver() wasn't called")),setDriver:function(t,i){var f=new e(function(e,i){if(!a&&t===s.INDEXEDDB||!u&&t===s.WEBSQL)return void i(s);if(s._ready=null,o===n)return void require([t],function(n){s._extend(n),e(s)});if(o===r){var f;switch(t){case s.INDEXEDDB:f=require("localforage/src/drivers/indexeddb");break;case s.LOCALSTORAGE:f=require("localforage/src/drivers/localstorage");break;case s.WEBSQL:f=require("localforage/src/drivers/websql")}s._extend(f)}else s._extend(c[t]);e(s)});return f.then(i,i),f},ready:function(e){return null===this._ready&&(this._ready=this._initStorage(this.config)),this._ready.then(e,e),this._ready},_extend:function(e){for(var n in e)e.hasOwnProperty(n)&&(this[n]=e[n])}};i=a?s.INDEXEDDB:u?s.WEBSQL:s.LOCALSTORAGE,this.localForageConfig&&(s.config=this.localForageConfig),s.setDriver(i),o===n?define(function(){return s}):o===r?module.exports=s:this.localforage=s}.call(this);
!function(e,n){"use strict";var t=n.module("LocalForageModule",["ng"]);t.provider("$localForage",function(){e.localForageConfig={name:"lf"},this.notify={setItem:!1,removeItem:!1},this.setPrefix=function(t){n.isDefined(t)&&t!==e.localForageConfig.name&&(e.localForageConfig.name=t,localforage._initStorage(e.localForageConfig))};var t=function(e){return localforage.setDriver(e)};this.setDriver=t;var r=function(){return localforage.driver()};this.setNotify=function(e,n){this.notify={setItem:e,removeItem:n}},this.config=function(r){return n.isObject(r)?(e.localForageConfig=r,n.isDefined(r.driver)?t(r.driver):localforage._initStorage(r)):void 0},this.$get=["$rootScope","$q","$parse",function(e,o,i){var a=this.notify,l={},f=function(){return"localStorageWrapper"===r()?"lfp.":""},c=function(e,n,o,i){"InvalidStateError"===e&&"asyncStorage"===r()?t("localStorageWrapper").then(function(){o(n).then(function(e){i.resolve(e)},function(e){i.reject(e)})},function(){i.reject(e)}):i.reject(e)},u=function(n,t){var r=o.defer(),i=arguments;return localforage.setItem(f()+n,t).then(function(){a.setItem&&e.$broadcast("LocalForageModule.setItem",{key:n,newvalue:t,driver:localforage.driver()}),r.resolve()},function(e){c(e,i,u,r)}),r.promise},s=function(e){var n=o.defer(),t=arguments;return localforage.getItem(f()+e).then(function(e){n.resolve(e)},function(e){c(e,t,s,n)}),n.promise},g=function(n){var t=localforage.removeItem(f()+n);return a.setItem?t.then(function(){e.$broadcast("LocalForageModule.removeItem",{key:n,driver:localforage.driver()})}):t},d=function(){var e=o.defer(),t=arguments,r=[];return h().then(function(t){n.forEach(t,function(e){r.push(g(e))}),o.all(r).then(function(){e.resolve()})},function(n){c(n,t,clearAll,e)}),e.promise},v=function(e){var n=o.defer(),t=arguments;return localforage.key(e).then(function(e){n.resolve(e)},function(e){c(e,t,v,n)}),n.promise},m=function(){var e=o.defer(),n=arguments;return localforage.length().then(function(n){e.resolve(n)},function(t){c(t,n,m,e)}),e.promise},h=function(){var e=o.defer(),n=arguments;return m().then(function(n){for(var t=[],r=[],i=f(),a=0;n>a;a++)t.push(v(a).then(function(e){0===e.indexOf(i)&&r.push(e.substr(i.length,e.length))}));o.all(t).then(function(){e.resolve(r)})},function(t){c(t,n,h,e)}),e.promise},y=function(e,t){if(n.isString(t))t={key:t};else if(!n.isObject(t)||n.isUndefined(t.key))throw"You must defined a key to bind";var r={defaultValue:"",storeName:""};t=n.extend(r,t||{});var o=t.storeName||t.key,a=i(t.key);return s(o).then(function(r){r?a.assign(e,r):t.defaultValue&&u(o,t.defaultValue),n.isDefined(l[t.key])&&l[t.key](),l[t.key]=e.$watch(i(t.key),function(e){n.isDefined(e)&&u(o,e)},!0)})},p=function(e,t,r){r=r||t,i(t).assign(e,null),n.isDefined(l[t])&&(l[t](),delete l[t]),g(r)};return{setDriver:t,driver:r,getDriver:r,setItem:u,set:u,getItem:s,get:s,remove:g,removeItem:g,clear:d,clearAll:d,key:v,getKeyAt:v,getKeys:h,length:m,getLength:m,bind:y,unbind:p}}]}),t.directive("localForage",["$localForage",function(e){return{restrict:"A",link:function(t,r,o){var i=t.$eval(o.localForage);n.isObject(i)&&n.isDefined(i.key)&&n.isDefined(i.storeName)?e.bind(t,i):e.bind(t,o.localForage)}}}])}(window,window.angular);
!function(e){"use strict";var a=e.module("martVisualEnrichment",["ngRoute","ui.bootstrap","LocalForageModule","martVisualEnrichment.services","martVisualEnrichment.controllers","martVisualEnrichment.directives"]);a.config(["$routeProvider",function(e){var a={reloadOnSearch:!1,controller:["$scope","$location","mvConfig","coll",function(e,a,r,i){e.species=i.species,e.containers=i.containers;var t=r.defaults||{},n=Object.keys(t),c=a.search();n.forEach(function(e){e in c||(c[e]=t[e])}),a.search(c)}],templateUrl:"mart-visual-enrichment/app/partials/enrichment.html",resolve:{coll:["$route","$location","$q","bmservice",function(e,a,r,i){var t=i.marts(e.current.params.gui).then(function(e){return e.data.marts[0].config}),n=t.then(function(e){return"config"in a.search()||a.search("config",e),i.datasets(e)}).then(function(e){return e.data}),c=r.all({config:t,species:n}).then(function(e){var r=a.search().species;return r||a.search("species",r=e.species[0].name),i.containers(r,e.config,!0).then(function(e){return e.data})});return r.all({species:n,containers:c})}]}},r={templateUrl:"mart-visual-enrichment/app/partials/mart-visual-enrichment.html"};e.when("/gui/:gui/",a).when("/visualization/",r).otherwise("/")}]),a.config(["$localForageProvider",function(e){e.config({driver:"localStorageWrapper",name:"mve",storeName:"keyvaluepairs",description:"query parameters for enrichment"})}]),a.run(function(){"undefined"==typeof window.escapeHtmlEntities&&(window.escapeHtmlEntities=function(e){return e.replace(/[\u00A0-\u2666<>\&]/g,function(e){return"&"+(window.escapeHtmlEntities.entityTable[e.charCodeAt(0)]||"#"+e.charCodeAt(0))+";"})},window.escapeHtmlEntities.entityTable={34:"quot",38:"amp",39:"apos",60:"lt",62:"gt",160:"nbsp",161:"iexcl",162:"cent",163:"pound",164:"curren",165:"yen",166:"brvbar",167:"sect",168:"uml",169:"copy",170:"ordf",171:"laquo",172:"not",173:"shy",174:"reg",175:"macr",176:"deg",177:"plusmn",178:"sup2",179:"sup3",180:"acute",181:"micro",182:"para",183:"middot",184:"cedil",185:"sup1",186:"ordm",187:"raquo",188:"frac14",189:"frac12",190:"frac34",191:"iquest",192:"Agrave",193:"Aacute",194:"Acirc",195:"Atilde",196:"Auml",197:"Aring",198:"AElig",199:"Ccedil",200:"Egrave",201:"Eacute",202:"Ecirc",203:"Euml",204:"Igrave",205:"Iacute",206:"Icirc",207:"Iuml",208:"ETH",209:"Ntilde",210:"Ograve",211:"Oacute",212:"Ocirc",213:"Otilde",214:"Ouml",215:"times",216:"Oslash",217:"Ugrave",218:"Uacute",219:"Ucirc",220:"Uuml",221:"Yacute",222:"THORN",223:"szlig",224:"agrave",225:"aacute",226:"acirc",227:"atilde",228:"auml",229:"aring",230:"aelig",231:"ccedil",232:"egrave",233:"eacute",234:"ecirc",235:"euml",236:"igrave",237:"iacute",238:"icirc",239:"iuml",240:"eth",241:"ntilde",242:"ograve",243:"oacute",244:"ocirc",245:"otilde",246:"ouml",247:"divide",248:"oslash",249:"ugrave",250:"uacute",251:"ucirc",252:"uuml",253:"yacute",254:"thorn",255:"yuml",402:"fnof",913:"Alpha",914:"Beta",915:"Gamma",916:"Delta",917:"Epsilon",918:"Zeta",919:"Eta",920:"Theta",921:"Iota",922:"Kappa",923:"Lambda",924:"Mu",925:"Nu",926:"Xi",927:"Omicron",928:"Pi",929:"Rho",931:"Sigma",932:"Tau",933:"Upsilon",934:"Phi",935:"Chi",936:"Psi",937:"Omega",945:"alpha",946:"beta",947:"gamma",948:"delta",949:"epsilon",950:"zeta",951:"eta",952:"theta",953:"iota",954:"kappa",955:"lambda",956:"mu",957:"nu",958:"xi",959:"omicron",960:"pi",961:"rho",962:"sigmaf",963:"sigma",964:"tau",965:"upsilon",966:"phi",967:"chi",968:"psi",969:"omega",977:"thetasym",978:"upsih",982:"piv",8226:"bull",8230:"hellip",8242:"prime",8243:"Prime",8254:"oline",8260:"frasl",8472:"weierp",8465:"image",8476:"real",8482:"trade",8501:"alefsym",8592:"larr",8593:"uarr",8594:"rarr",8595:"darr",8596:"harr",8629:"crarr",8656:"lArr",8657:"uArr",8658:"rArr",8659:"dArr",8660:"hArr",8704:"forall",8706:"part",8707:"exist",8709:"empty",8711:"nabla",8712:"isin",8713:"notin",8715:"ni",8719:"prod",8721:"sum",8722:"minus",8727:"lowast",8730:"radic",8733:"prop",8734:"infin",8736:"ang",8743:"and",8744:"or",8745:"cap",8746:"cup",8747:"int",8756:"there4",8764:"sim",8773:"cong",8776:"asymp",8800:"ne",8801:"equiv",8804:"le",8805:"ge",8834:"sub",8835:"sup",8836:"nsub",8838:"sube",8839:"supe",8853:"oplus",8855:"otimes",8869:"perp",8901:"sdot",8968:"lceil",8969:"rceil",8970:"lfloor",8971:"rfloor",9001:"lang",9002:"rang",9674:"loz",9824:"spades",9827:"clubs",9829:"hearts",9830:"diams",338:"OElig",339:"oelig",352:"Scaron",353:"scaron",376:"Yuml",710:"circ",732:"tilde",8194:"ensp",8195:"emsp",8201:"thinsp",8204:"zwnj",8205:"zwj",8206:"lrm",8207:"rlm",8211:"ndash",8212:"mdash",8216:"lsquo",8217:"rsquo",8218:"sbquo",8220:"ldquo",8221:"rdquo",8222:"bdquo",8224:"dagger",8225:"Dagger",8240:"permil",8249:"lsaquo",8250:"rsaquo",8364:"euro"})})}(angular);
!function(e){"use strict";e.module("martVisualEnrichment.services",[])}(angular);
!function(e){"use strict";e.module("martVisualEnrichment.services").service("bmservice",["$http","mvConfig",function(t,n){var i=n.url,r=n.queryUrl,s={cache:!0,timeout:1e6};this.marts=function(n,r){return r=r||{},t.get(i+"/gui.json?name="+n,e.extend({},s,r))},this.datasets=function(n,r){r=r||{};var a=i+"/datasets.json?config="+n;return t.get(a,e.extend({},s,r))},this.containers=function(n,r,a,u,o){o=o||{};var c=a,d=u,f=i+"/containers.json?datasets="+n+"&config="+r;return e.isDefined(c)&&(f+="&withfilters="+!!c),e.isDefined(d)&&(f+="&withattributes="+!!d),t.get(f,e.extend({},s,o))},this.query=function(n){var i=e.extend({headers:{"Content-Type":"application/x-www-form-urlencoded"}},s);return t.post(r,$.param({query:n}),i)}}])}(angular);
!function(e){"use strict";e.module("martVisualEnrichment.services").factory("mvConfig",[function(){var t="enrichment-config",n=document.getElementById(t),r={url:"/martservice",queryUrl:"/martservice/results",visualizationUrl:"/visualization/",defaults:{cutoff:.05,annotation:["Gene Ontology (GO)"]}};return n&&(r=e.merge(JSON.parse(n.textContent),r)),r}])}(angular);
!function(t){"use strict";var n=t.module("martVisualEnrichment.services");n.factory("findBioElement",function(){function n(t){return this instanceof n?(this.coll=t,void(this.funcs={})):new n(t)}return n.prototype.addFunctions=function(n){return t.isArray(n)?n.forEach(function(t){t in this.funcs||(this.funcs[t]={attributes:[],filters:[]})},this):n in this.funcs||(this.funcs[n]={attributes:[],filters:[]}),this},n.prototype.find=function(){for(var t,n=[this.coll];n.length;){t=n.shift(),t.attributes&&this.inspectAttrs(t.attributes,this.funcs),t.filters&&this.inspectFilters(t.filters,this.funcs);for(var i=0;i<t.containers.length;++i)n.push(t.containers[i])}return this.funcs},n.prototype.inspectAttrs=function(t,n){this.inspect(t,n,"attributes")},n.prototype.inspectFilters=function(t,n){this.inspect(t,n,"filters")},n.prototype.inspect=function(t,n,i){t.reduce(function(t,n){var s;return(s=n.function)in t&&t[s][i].push(n),t},n)},n.prototype.getFunctionMap=function(){return this.funcs},n})}(angular);
(function(t){"use strict";function e(t,e,n){this.$q=t,this.$loc=e,this.$localForage=n,this._lastAction=this.$q.when(42)}var n=t.module("martVisualEnrichment.services");e.$inject=["$q","$location","$localForage","$rootScope"],n.service("queryStore",e),e.prototype={_ready:function(){var t=this;return this._readyPromise=this._readyPromise||this.$q.all([this.getDb().getItem(this._attrKeys).then(function(e){return e?void 0:t.getDb().setItem(t._attrKeys,[])}),this.getDb().getItem(this._filterKeys).then(function(e){return e?void 0:t.getDb().setItem(t._filterKeys,[])}),this._lastAction]),this._readyPromise},_filterKeys:"qs.filters",_attrKeys:"qs.attrs",_configKey:"qs.config",_datasetKey:"qs.dataset",_coll:function(t){var e=this.getDb(),n=this;return this._ready().then(function(){return e.getItem(t).then(function(t){var r=t.reduce(function(t,n){return t[n]=e.getItem(n),t},{});return n.$q.all(r)})})},_checkName:function(e){if(!t.isString(e))throw new Error("`name` is not either a string, null or undefined: "+e)},_addItem:function(t,e,n,r){var i=this.getDb();return i.getItem(t).then(function(s){return-1!==r?i.setItem(e,n):(s.push(e),i.setItem(t,s).then(function(){return i.setItem(e,n)}))})},_removeItem:function(t,e,n){var r=this.getDb();return r.getItem(t).then(function(i){return i.splice(n,1),r.setItem(t,i).then(function(){return r.removeItem(e)})})},_elem:function(e,n,r){var i=this.getDb(),s=this;return this._lastAction=this._lastAction.then(function(){return s._ready().then(function(){return i.getItem(e).then(function(u){var o,a=u.indexOf(n);return o=null!==r&&t.isDefined(r)?s._addItem(e,n,r,a):null===r&&-1!==a?s._removeItem(e,n,a):i.getItem(n)})})})},getDb:function(){return this.$localForage},filter:function(t,e){var n=this;return this._checkName(t),this._ready().then(function(){return n._elem(n._filterKeys,t,e)})},allFilters:function(){var t=this;return this._ready().then(function(){return t._coll(t._filterKeys)})},attr:function(t,e){var n=this;return this._checkName(t),this._ready().then(function(){return n._elem(n._attrKeys,t,e)})},allAttrs:function(){var t=this;return this._ready().then(function(){return t._coll(t._attrKeys)})},config:function(e){var n=this.getDb(),r=this;return this._ready().then(function(){if(t.isString(e))return n.setItem(r._configKey,e);if(null===e||t.isUndefined(e))return n.getItem(r._configKey);throw new Error("`name` must be a string, null or undefined")})},dataset:function(e){var n=this.getDb(),r=this;return this._ready().then(function(){if(t.isString(e))return n.setItem(r._datasetKey,e);if(null===e||t.isUndefined(e))return n.getItem(r._datasetKey);throw new Error("`name` must be a string, null or undefined")})},clear:function(){var t=this;return t._ready().then(function(){return t._lastAction=t._lastAction.then(function(){return t.getDb().clear().then(function(){t._readyPromise=null})})})}}}).call(this,angular);
!function(t){"use strict";function r(r,e,i,n,u,s,a,c){a=a?1:0,c=c||"";var l=["<!DOCTYPE Query>",'<Query client="'+c+'" processor="'+u+'"'+(s?' limit="'+s+'"':"-1")+' header="'+a+'">'];return r?(l.push(['  <Dataset name="',r,'" ','config="'+e+'">'].join("")),Object.keys(i).forEach(function(r){var e=i[r];if(t.isDefined(e)&&null!==e){if(t.isString(e)&&""===e.trim())return;l.push('    <Filter name="'+r+'">'+e+"</Filter>")}}),Object.keys(n).forEach(function(t){var r=n[t];r&&l.push('    <Attribute name="'+t+'"></Attribute>')}),l.push("  </Dataset>"),l.push("</Query>"),l.join("\n")):null}var e=t.module("martVisualEnrichment.services");e.service("queryBuilder",["queryStore","$q",function(t,e){this.build=function(){var t=-1,r=!0,e="true";return this._mkQuery("TSV",t,r,e)},this._mkQuery=function(i,n,u,s){return e.all({config:t.config(),dataset:t.dataset(),filters:t.allFilters(),attrs:t.allAttrs()}).then(function(t){return r(t.dataset,t.config,t.filters,t.attrs,i,n,u,s)})},this.show=function(){var t=-1,r=!0,e="false";return this._mkQuery("TSV",t,r,e)}}])}(angular);
!function(e){"use strict";function t(t){function n(t){return e.isDefined(t)&&""!==t}function r(e){return!n(e)}function s(){var n=e.element(".mve-sets-form textarea"),r=e.element(".mve-bed-form textarea");return e.extend(t.search(),{dataset:t.search().species,sets:n?n.val():void 0,bed:r?r.val():void 0})}this.err="",this.validate=function(){var t=s();return n(t.sets)^n(t.bed)?r(t.cutoff)||+t.cutoff!=parseFloat(t.cutoff)?(this.err="The cutoff must be provided and a number.",!1):r(t.annotation)||e.isArray(t.annotation)&&!t.annotation.length?(this.err="Atleast one annotation must be selected, please.",!1):(this.err="",!0):(this.err=n(t.sets)?"There can only be a list of genes or a BED file, not both.":"One between list of genes and BED file must be chosen, please.",!1)},this.errMessage=function(){return this.err}}var n=e.module("martVisualEnrichment.services");t.$inject=["$location"],n.service("queryValidator",t)}(angular);
!function(r){"use strict";var n=r.module("martVisualEnrichment.services");n.factory("sanitize",function(){return{stripTags:function(r){return r.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"")}}})}(angular);
(function(n){"use strict";function r(n){var r=[];return{onStoreState:function(n){return r.push(n),function(){r.splice(r.indexOf(n),1)}},broadcast:function(){for(var t=[],e=0,u=r.length;u>e;++e)t.push(r[e].call(null));return n.all(t)}}}var t=n.module("martVisualEnrichment.services");r.$inject=["$q","$rootScope"],t.factory("storePusher",r)}).call(null,angular);
!function(n){"use strict";n.module("martVisualEnrichment.controllers",[])}(angular);
!function(e){"use strict";var s=e.module("martVisualEnrichment.controllers");s.controller("SpeciesCtrl",["$scope","$location","$route","queryStore",function(e,s,t,c){var i=s.search().species;this.getSpeciesByName=function(s){for(var t=0,c=e.species.length,i="";c>t;++t)if(i=e.species[t],i.name===s)return i;throw new Error("Cannot find species with name "+s)},this.updateSpecies=function(e){var i=s.search(),n={};n.config=i.config,n.species=e.name,s.search(n),c.clear().then(function(){t.reload()})},e.updateSpecies=this.updateSpecies,e.selectedSpecies=this.getSpeciesByName(i),e.$on("$routeUpdate",function(){var t=s.search().species;t!==e.selectedSpecies.name&&(e.selectedSpecies=this.getSpeciesByName(t))}.bind(this))}])}(angular);
!function(t){"use strict";function n(t,n,e,o,a,i){var l=this;l.$loc=n,l.$log=e,l.bm=o,l.find=a,l.store=i,l.containers=t.containers,t.$on("$routeUpdate",function(){l.expandCollapsable()}),l.init()}var e=t.module("martVisualEnrichment.controllers");e.controller("EnrichmentCtrl",["$scope","$location","$log","bmservice","findBioElement","$localForage",n]),n.prototype={init:function(){var t=this,n=t.$loc.search();t.reqs=["cutoff","bonferroni","bed_regions","sets","background","upstream","downstream","gene_type","gene_limit","homolog","annotation"],t.enElementValues=t.findElements(t.containers),t.expandCollapsable(),t.selectTab(+n[t.ACTIVE_TAB])},BK_COLLAPSED:"background.show",ANN_COLLAPSED:"annotation.show",CUTOFF_COLLAPSED:"cutoff.show",ACTIVE_TAB:"tab",expandCollapsable:function(){var t=this;t.backgroundIsCollapsed=t._isCollapsed(t.BK_COLLAPSED),t.cutoffIsCollapsed=t._isCollapsed(t.CUTOFF_COLLAPSED),t.annotationIsCollapsed=t._isCollapsed(t.ANN_COLLAPSED)},selectTab:function(t){var n=this;n.bedTabActive=n.geneTabActive=!1,2===t?n.bedTabActive=!0:n.geneTabActive=!0,n._updateUrl(this.ACTIVE_TAB,t)},_updateUrl:function(t,n){this.$loc.search(t,n.toString())},_isCollapsed:function(t){var n=this,e=n.$loc.search();return!("true"===e[t])},onClickBackground:function(){var t=this;t._updateUrl(t.BK_COLLAPSED,t._isCollapsed(t.BK_COLLAPSED))},onClickCutoff:function(){var t=this;t._updateUrl(t.CUTOFF_COLLAPSED,t.cutoffIsCollapsed)},onClickAnnotation:function(){var t=this;t._updateUrl(t.ANN_COLLAPSED,t.annotationIsCollapsed)},findElements:function(t){var n=this,e=n.find(t).addFunctions(n.reqs);return e.find()},getElements:function(t,n){var e=this,o=e.enElementValues[t];return o&&o[n]?o[n]:[]},getFilter:function(t){var n=this.getElements(t,"filters");return n.length?n[0]:null},getAttributes:function(t){return this.getElements(t,"attributes")}}}(angular);
!function(o){"use strict";function e(o,e,r,t,n,i,s,a,c,u,l){var d=this;d.win=r,d.$modal=a,d.qv=t,d.qb=n,d.$loc=e,d.$rootScope=i,d.config=s,d.qs=c,d.$route=u,d.storePusher=l,o.$on("$destroy",d.storePusher.onStoreState(function(){var o=d.$loc.search(),e=o.config;return d.qs.config(e)})),o.$on("$destroy",d.storePusher.onStoreState(function(){var o=d.$loc.search(),e=o.species;return d.qs.dataset(e)}))}var r=o.module("martVisualEnrichment.controllers");r.controller("QueryCtrl",e),e.$inject=["$scope","$location","$window","queryValidator","queryBuilder","$rootScope","mvConfig","$modal","queryStore","$route","storePusher"],e.prototype={submit:function(){var o=this;o.validate()?o.buildQuery().then(function(){o.$loc.url(o.config.visualizationUrl)}):o.showError(o.qv.errMessage())},showError:function(o){this.win.alert(o)},openModal:function(o){this.$modal.open({template:'<div class="modal-header"><h2>XML</h2></div><div class="modal-body"><pre><code>"'+window.escapeHtmlEntities(o)+'"</code></pre></div>'})},clear:function(){var o=this;o.qs.clear().then(function(){var e=o.$loc.search(),r={config:e.config,species:e.species,cutoff:o.config.defaults.cutoff,annotation:o.config.defaults.annotation};o.$loc.search(r),o.$route.reload()})},validate:function(){return this.qv.validate()},buildQuery:function(){var o=this;return o.qs.clear().then(function(){return o.storePusher.broadcast()})},showQuery:function(){var o=this;return o.validate()?o.qs.clear().then(function(){return o.storePusher.broadcast()}).then(function(){return o.qb.show()}).then(function(e){return o.openModal(e)}):o.showError(o.qv.errMessage())}}}(angular);
!function(i){"use strict";i.module("martVisualEnrichment.directives",[])}(angular);
!function(e){"use strict";var c=e.module("martVisualEnrichment.directives");c.directive("mvSpecies",["$location",function(e){return{restrict:"E",templateUrl:"mart-visual-enrichment/app/partials/species.html",scope:!0,link:function(c,i,s){function r(){var i=e.search(),s=i.species;if(s&&s!==c.currentSpeciesName){for(var r=0,t=c.species.length;t>r;++r){var a=c.species[r];if(a.name===s)return c.currentSpeciesName=s,void(c.selectedSpecies=a)}e.search("species",c.selectedSpecies)}}c.species=c.$parent.$eval(s.species),r(),c.$on("$routeUpdate",r),c.updateSpecies=function(i){c.currentSpeciesName=i.name,e.search("species",i.name)}}}}])}(angular);
!function(e){"use strict";function t(e,t){var n=e.defer(),r=t.target.files[0];if(r){var i=new FileReader;return i.readAsText(r,"UTF-8"),i.onload=function(e){n.resolve(e.target.result)},i.onerror=function(){n.reject("Error reading file")},n.promise}return n.reject("No file provided")}function n(t){var n=this;this.pushStateToStore=function(e){return this.qs.filter(n.getFilterKey(),e)},this.pushStateToUrl=function(t){var r=n.getQueryParam();r&&(e.isString(t)&&""===t.trim()&&(t=null),this.$loc.search(r,t))},this.getUrlVal=function(){var e=n.getQueryParam();if(e){var t=this.$loc.search();return t[e]}},this.getStoredVal=function(){return n.qs.filter(n.getFilterKey())},this.getVal=function(){return t.filter.value}}function r(e){var t=this;e.onTextChange=function(e){t.pushStateToUrl(e)}}function i(t){var n=this;t.onSelect=function(e){t.prevSelected!==e&&(t.prevSelected=t.selected=e,n.pushStateToUrl(t.options.indexOf(e)))},t.$on("$destroy",t.$on("$routeUpdate",function(){var r=+n.$loc.search()[n.getQueryParam()];e.isNumber(r)&&!isNaN(r)&&t.onSelect(t.options[r])}))}function l(e){var n=this;e.onTextChange=function(e){n.setBindings(e)},e.onFileUpload=function(e){function r(e){n.setBindings(e)}t(n.$q,e).then(function(e){return e?n.sanitize.stripTags(e):null},function(){return null}).then(r,r)}}var o=e.module("martVisualEnrichment.directives"),a="mart-visual-enrichment/app/partials",u={call:function(e){var t=e.getUrlVal();t&&e.setBindings(t)}},c={call:function(e,t,n){n.on("change",t.onFileUpload),t.$on("$destroy",function(){n.off("change")}),e.getStoredVal().then(function(t){e.setBindings(t)})}},s={call:function(t,n){var r=t.$loc.search(),i=+r[t.getQueryParam()],l=e.isNumber(i)&&!isNaN(i)?i:0;t.pushStateToUrl(l),n.prevSelected=n.selected=n.options[l]}},f={call:function(e,t){t.$on("$destroy",e.storePusher.onStoreState(function(){return e.pushStateToStore(e.getVal())}))}};o.directive("uploadFilter",["storePusher","$q","queryStore","sanitize",function(e,t,r,i){return{restrict:"E",templateUrl:a+"/upload-filter.html",scope:{},link:function(o,a,s){o.filter=o.$parent.$eval(s.filter);var g={};g.$q=t,g.qs=r,g.sanitize=i,g.storePusher=e,g.getFilterKey=function(){return o.filter.name},g.getQueryParam=function(){},g.setBindings=function(e){e=e?i.stripTags(e):null,o.filter.value=e},n.call(g,o),l.call(g,o),f.call(g,o),u.call(g,o),c.call(g,o,a.find("input"))}}}]),o.directive("singleSelectUploadFilter",["storePusher","$q","queryStore","sanitize","$location",function(e,t,r,o,u){return{restrict:"E",templateUrl:a+"/single-select-upload-filter.html",scope:{},link:function(a,g,d){a.filter=a.$parent.$eval(d.filter);var p={};p.$q=t,p.qs=r,p.sanitize=o,p.$loc=u,p.storePusher=e,a.options=a.filter.filters,p.getFilterKey=function(){return a.prevSelected.name},p.getQueryParam=function(){return a.filter.function},p.setBindings=function(e){e=e?o.stripTags(e):null,a.filter.value=e},n.call(p,a),i.call(p,a),l.call(p,a,g),f.call(p,a),s.call(p,a),c.call(p,a,g.find("input"))}}}]),o.directive("textFilter",["storePusher","queryStore","$location","sanitize",function(t,i,l,o){return{restrict:"E",templateUrl:a+"/text-filter.html",scope:{},link:function(a,c,s){a.filter=a.$parent.$eval(s.filter);var g={};g.$loc=l,g.qs=i,g.sanitize=o,g.storePusher=t,g.getFilterKey=function(){return a.filter.name},g.getQueryParam=function(){return a.filter.function},g.setBindings=function(t){t=e.isDefined(t)&&!isNaN(+t)?e.isString(t)&&""!==t.trim()?o.stripTags(t):t:null,a.filter.value=t},a.$on("$routeUpdate",function(){g.setBindings(g.getUrlVal())}),n.call(g,a),r.call(g,a),f.call(g,a),u.call(g,a)}}}]),o.directive("booleanFilter",["storePusher","queryStore","$location",function(e,t,r){return{restrict:"E",templateUrl:a+"/boolean-filter.html",scope:{},link:function(i,l,o){i.filter=i.$parent.$eval(o.filter);var a={};a.$loc=r,a.qs=t,a.storePusher=e,a.getFilterKey=function(){return i.filter.name},a.getQueryParam=function(){return i.filter.function},a.setBindings=function(e){i.filter.value=e},i.$on("$routeUpdate",function(){a.setBindings(a.getUrlVal())});var a=a;i.set=function(e){a.pushStateToUrl(e)},n.call(a,i),f.call(a,i)}}}]),o.directive("singleSelectBooleanFilter",["storePusher","queryStore","$location",function(e,t,r){return{restrict:"E",templateUrl:a+"/single-select-boolean-filter.html",scope:{},link:function(e,l,o){e.filter=e.$parent.$eval(o.filter);var a={};a.$loc=r,a.qs=t,a.getFilterKey=function(){return e.prevSelected.name},a.getQueryParam=function(){return e.filter.function},a.setBindings=function(){e.filter.value="only"},e.$on("$routeUpdate",function(){a.setBindings(a.getUrlVal())}),n.call(a,e),i.call(a,e),f.call(a,e)}}}])}(angular);
!function(t){"use strict";var e=t.module("martVisualEnrichment.directives");e.directive("mvFilter",[function(){return{restrict:"A",templateUrl:"mart-visual-enrichment/app/partials/filter.html",scope:!0,link:function(t,e,r){r.mvFilter&&(t.filter=t.$parent.$eval(r.mvFilter))}}}])}(angular);
!function(t){"use strict";function e(e,r,n){function a(e){return t.isArray(e)?e:t.isDefined(e)?[e]:[]}return{restrict:"A",scope:{},templateUrl:"mart-visual-enrichment/app/partials/attribute.html",link:function(t,i,c){function u(){var e=r.search()[t.attr.function];return e&&-1!==e.indexOf(t.attr.name)||t.attr.selected}t.attr=t.$parent.$eval(c.mvAttribute),t.$on("$destroy",n.onStoreState(function(){return t.checked?e.attr(t.attr.name,t.attr.name):void 0})),t.$on("$routeUpdate",function(){t.checked=u()}),t.setAttribute=function(e){var n=a(r.search()[t.attr.function]);e?n.push(t.attr.name):n.splice(n.indexOf(t.attr.name),1),r.search(t.attr.function,n)},t.checked=u()}}}var r=t.module("martVisualEnrichment.directives");e.$inject=["queryStore","$location","storePusher"],r.directive("mvAttribute",e)}(angular);
!function(t,e){"function"==typeof define&&define.amd?define(["d3"],e):t.d3.tip=e(t.d3)}(this,function(t){return function(){function e(t){w=m(t),T=w.createSVGPoint(),document.body.appendChild(v)}function n(){return"n"}function r(){return[0,0]}function o(){return" "}function l(){var t=d();return{top:t.n.y-v.offsetHeight,left:t.n.x-v.offsetWidth/2}}function s(){var t=d();return{top:t.s.y,left:t.s.x-v.offsetWidth/2}}function f(){var t=d();return{top:t.e.y-v.offsetHeight/2,left:t.e.x}}function i(){var t=d();return{top:t.w.y-v.offsetHeight/2,left:t.w.x-v.offsetWidth}}function u(){var t=d();return{top:t.nw.y-v.offsetHeight,left:t.nw.x-v.offsetWidth}}function a(){var t=d();return{top:t.ne.y-v.offsetHeight,left:t.ne.x}}function c(){var t=d();return{top:t.sw.y,left:t.sw.x-v.offsetWidth}}function p(){var t=d();return{top:t.se.y,left:t.e.x}}function y(){var e=t.select(document.createElement("div"));return e.style({position:"absolute",top:0,opacity:0,"pointer-events":"none","box-sizing":"border-box"}),e.node()}function m(t){return t=t.node(),"svg"==t.tagName.toLowerCase()?t:t.ownerSVGElement}function d(){var e=b||t.event.target,n={},r=e.getScreenCTM(),o=e.getBBox(),l=o.width,s=o.height,f=o.x,i=o.y;return T.x=f,T.y=i,n.nw=T.matrixTransform(r),T.x+=l,n.ne=T.matrixTransform(r),T.y+=s,n.se=T.matrixTransform(r),T.x-=l,n.sw=T.matrixTransform(r),T.y-=s/2,n.w=T.matrixTransform(r),T.x+=l,n.e=T.matrixTransform(r),T.x-=l/2,T.y-=s/2,n.n=T.matrixTransform(r),T.y+=s,n.s=T.matrixTransform(r),n}var g=n,h=r,x=o,v=y(),w=null,T=null,b=null;e.show=function(){var n=Array.prototype.slice.call(arguments);n[n.length-1]instanceof SVGElement&&(b=n.pop());var r,o=x.apply(this,n),l=h.apply(this,n),s=g.apply(this,n),f=t.select(v),i=H.length,u=document.documentElement.scrollTop||document.body.scrollTop,a=document.documentElement.scrollLeft||document.body.scrollLeft;for(f.html(o).style({opacity:1,"pointer-events":"all"});i--;)f.classed(H[i],!1);return r=E.get(s).apply(this),f.classed(s,!0).style({top:r.top+l[0]+u+"px",left:r.left+l[1]+a+"px"}),e},e.hide=function(){return nodel=t.select(v),nodel.style({opacity:0,"pointer-events":"none"}),e},e.attr=function(n){if(arguments.length<2&&"string"==typeof n)return t.select(v).attr(n);var r=Array.prototype.slice.call(arguments);return t.selection.prototype.attr.apply(t.select(v),r),e},e.style=function(n){if(arguments.length<2&&"string"==typeof n)return t.select(v).style(n);var r=Array.prototype.slice.call(arguments);return t.selection.prototype.style.apply(t.select(v),r),e},e.direction=function(n){return arguments.length?(g=null==n?n:t.functor(n),e):g},e.offset=function(n){return arguments.length?(h=null==n?n:t.functor(n),e):h},e.html=function(n){return arguments.length?(x=null==n?n:t.functor(n),e):x};var E=t.map({n:l,s:s,e:f,w:i,nw:u,ne:a,sw:c,se:p}),H=E.keys();return e}});
!function(t){"use strict";t.module("martVisualEnrichment.services").factory("termsAsync",function(){return function(t){this._all=t.then(function(t){return t.filter(function(t){return"term"===t.type})}),this._filtered=this._all,this.all=function(){return this._clearFilters(),this},this._clearFilters=function(){return this._filtered=null,this._filtered=this._all,this},this.filterByDescription=function(t){if(t&&""!==t){var i=new RegExp(t,"i");this._filtered=this._filtered.then(function(t){return t.filter(function(t){return t.description.match(i)})})}return this},this.filterByScore=function(t,i){return this._filtered=this._filtered.then(function(e){return e.filter(function(e){return e["p-value"]>=t&&e["p-value"]<i})}),this},this.then=function(t,i,e){var r=this._filtered.then(t,i,e);return this._clearFilters(),r}}})}(angular);
!function(e){"use strict";e.module("martVisualEnrichment.services").service("terms",["termsAsync",function(e){this.get=function(n){return new e(n)}}])}(angular);
(function(t){"use strict";var e=t.module("martVisualEnrichment.services");e.factory("progressState",function(){var t={},e=["GETTING_DATA","PROCESSING","TABLE","NETWORK","DONE","ERROR"];return t.states={},e.forEach(function(e,r){Object.defineProperty(t.states,e,{value:r,enumerable:!0})}),t.currentState=t.states.GETTING_DATA,t.setState=function(r){e[r]in t.states&&(this.currentState=r)},t})}).call(this,angular);
(function(e){"use strict";var t=e.module("martVisualEnrichment.controllers");t.controller("ProgressCtrl",["$scope","progressState","$interval",function(e,t,s){function a(){e.progressbarValue+=1}var r,c=this;c.states=t.states,c.currentState=t.states.currentState,e.progressbarValue=0,e.max=100,e.$watch(function(){return t.currentState},function(t){switch(c.currentState=t,t){case c.states.GETTING_DATA:e.progressbarValue=1,r=s(a,1350,50);break;case c.states.PROCESSING:e.progressbarValue=60,s.cancel(r);break;case c.states.TABLE:e.progressbarValue=80;break;case c.states.NETWORK:case c.states.ERROR:case c.states.DONE:e.progressbarValue=100,s.cancel(r)}})}])}).call(this,angular);
!function(t){"use strict";var e=t.module("martVisualEnrichment.controllers");e.controller("VisualizationCtrl",["$scope","queryBuilder","bmservice","progressState",function(t,e,s,a){var r=this,n=e.build().then(function(t){return s.query(t,{cache:!1,headers:{Accept:"application/json,text/plain"}}).then(function(t){var e=t.data.graphs;return Object.keys(e).map(function(t){var s=e[t];return{title:t,nodes:s.nodes,edges:s.edges}})})});t.mvTabs=[],t.progressbarValue=33,r.state=a,r.state.setState(r.state.states.GETTING_DATA),n.then(function(e){t.mvTabs=e,r.state.setState(r.state.states.PROCESSING)},function(e){t.errorMessage=e.status,t.progressbarValue=100,r.state.setState(r.state.states.ERROR)})}])}(angular);
!function(t){"use strict";var e=t.module("martVisualEnrichment.controllers");e.controller("ResultsTableCtrl",["$scope","$q","$rootScope","terms",function(e,r,n,o){e.terms=o.get(r.when(e.mvTab.nodes)),e.terms.all().then(function(r){e.results=t.copy(r)}),e.filterByDescription=function(t){e.mvTab.pattern=t.toLowerCase(),e.terms.all().filterByDescription(t).then(function(t){e.results=t})}}])}(angular);
var saveAs=saveAs||"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(e){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var t=e.document,n=function(){return e.URL||e.webkitURL||e},o=e.URL||e.webkitURL||e,r=t.createElementNS("http://www.w3.org/1999/xhtml","a"),i=!e.externalHost&&"download"in r,a=e.webkitRequestFileSystem,u=e.requestFileSystem||a||e.mozRequestFileSystem,d=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},c="application/octet-stream",f=0,s=[],l=function(){for(var e=s.length;e--;){var t=s[e];"string"==typeof t?o.revokeObjectURL(t):t.remove()}s.length=0},v=function(e,t,n){t=[].concat(t);for(var o=t.length;o--;){var r=e["on"+t[o]];if("function"==typeof r)try{r.call(e,n||e)}catch(i){d(i)}}},w=function(o,d){var l,w,p,m=this,y=o.type,h=!1,g=function(){var e=n().createObjectURL(o);return s.push(e),e},E=function(){v(m,"writestart progress write writeend".split(" "))},R=function(){(h||!l)&&(l=g(o)),w?w.location.href=l:window.open(l,"_blank"),m.readyState=m.DONE,E()},S=function(e){return function(){return m.readyState!==m.DONE?e.apply(this,arguments):void 0}},O={create:!0,exclusive:!1};if(m.readyState=m.INIT,d||(d="download"),i){l=g(o),t=e.document,r=t.createElementNS("http://www.w3.org/1999/xhtml","a"),r.href=l,r.download=d;var b=t.createEvent("MouseEvents");return b.initMouseEvent("click",!0,!1,e,0,0,0,0,0,!1,!1,!1,!1,0,null),r.dispatchEvent(b),m.readyState=m.DONE,void E()}return e.chrome&&y&&y!==c&&(p=o.slice||o.webkitSlice,o=p.call(o,0,o.size,c),h=!0),a&&"download"!==d&&(d+=".download"),(y===c||a)&&(w=e),u?(f+=o.size,void u(e.TEMPORARY,f,S(function(e){e.root.getDirectory("saved",O,S(function(e){var t=function(){e.getFile(d,O,S(function(e){e.createWriter(S(function(t){t.onwriteend=function(t){w.location.href=e.toURL(),s.push(e),m.readyState=m.DONE,v(m,"writeend",t)},t.onerror=function(){var e=t.error;e.code!==e.ABORT_ERR&&R()},"writestart progress write abort".split(" ").forEach(function(e){t["on"+e]=m["on"+e]}),t.write(o),m.abort=function(){t.abort(),m.readyState=m.DONE},m.readyState=m.WRITING}),R)}),R)};e.getFile(d,{create:!1},S(function(e){e.remove(),t()}),S(function(e){e.code===e.NOT_FOUND_ERR?t():R()}))}),R)}),R)):void R()},p=w.prototype,m=function(e,t){return new w(e,t)};return p.abort=function(){var e=this;e.readyState=e.DONE,v(e,"abort")},p.readyState=p.INIT=0,p.WRITING=1,p.DONE=2,p.error=p.onwritestart=p.onprogress=p.onwrite=p.onabort=p.onerror=p.onwriteend=null,e.addEventListener("unload",l,!1),m.unload=function(){l(),e.removeEventListener("unload",l,!1)},m}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&null!==module?module.exports=saveAs:"undefined"!=typeof define&&null!==define&&null!=define.amd&&define([],function(){return saveAs});
function RGBColor(e){this.ok=!1,"#"==e.charAt(0)&&(e=e.substr(1,6)),e=e.replace(/ /g,""),e=e.toLowerCase();var f={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(var a in f)e==a&&(e=f[a]);for(var r=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(e){return[parseInt(e[1]),parseInt(e[2]),parseInt(e[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}}],t=0;t<r.length;t++){var d=r[t].re,l=r[t].process,n=d.exec(e);n&&(channels=l(n),this.r=channels[0],this.g=channels[1],this.b=channels[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var e=this.r.toString(16),f=this.g.toString(16),a=this.b.toString(16);return 1==e.length&&(e="0"+e),1==f.length&&(f="0"+f),1==a.length&&(a="0"+a),"#"+e+f+a},this.getHelpXML=function(){for(var e=new Array,a=0;a<r.length;a++)for(var t=r[a].example,d=0;d<t.length;d++)e[e.length]=t[d];for(var l in f)e[e.length]=l;var n=document.createElement("ul");n.setAttribute("id","rgbcolor-examples");for(var a=0;a<e.length;a++)try{var i=document.createElement("li"),o=new RGBColor(e[a]),s=document.createElement("div");s.style.cssText="margin: 3px; border: 1px solid black; background:"+o.toHex()+"; color:"+o.toHex(),s.appendChild(document.createTextNode("test"));var c=document.createTextNode(" "+e[a]+" -> "+o.toRGB()+" -> "+o.toHex());i.appendChild(s),i.appendChild(c),n.appendChild(i)}catch(b){}return n}}
function stackBlurImage(a,t,e,r){var n=document.getElementById(a),l=n.naturalWidth,g=n.naturalHeight,c=document.getElementById(t);c.style.width=l+"px",c.style.height=g+"px",c.width=l,c.height=g;var o=c.getContext("2d");o.clearRect(0,0,l,g),o.drawImage(n,0,0),isNaN(e)||1>e||(r?stackBlurCanvasRGBA(t,0,0,l,g,e):stackBlurCanvasRGB(t,0,0,l,g,e))}function stackBlurCanvasRGBA(a,t,e,r,n,l){if(!(isNaN(l)||1>l)){l|=0;var g,c=document.getElementById(a),o=c.getContext("2d");try{try{g=o.getImageData(t,e,r,n)}catch(s){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),g=o.getImageData(t,e,r,n)}catch(s){throw alert("Cannot access local image"),new Error("unable to access local image data: "+s)}}}catch(s){throw alert("Cannot access image"),new Error("unable to access image data: "+s)}var i,u,b,m,f,h,x,d,v,B,w,y,I,C,k,E,R,p,D,N,_,S,G,P,A=g.data,M=l+l+1,U=r-1,H=n-1,W=l+1,j=W*(W+1)/2,q=new BlurStack,z=q;for(b=1;M>b;b++)if(z=z.next=new BlurStack,b==W)var F=z;z.next=q;var J=null,K=null;x=h=0;var L=mul_table[l],O=shg_table[l];for(u=0;n>u;u++){for(E=R=p=D=d=v=B=w=0,y=W*(N=A[h]),I=W*(_=A[h+1]),C=W*(S=A[h+2]),k=W*(G=A[h+3]),d+=j*N,v+=j*_,B+=j*S,w+=j*G,z=q,b=0;W>b;b++)z.r=N,z.g=_,z.b=S,z.a=G,z=z.next;for(b=1;W>b;b++)m=h+((b>U?U:b)<<2),d+=(z.r=N=A[m])*(P=W-b),v+=(z.g=_=A[m+1])*P,B+=(z.b=S=A[m+2])*P,w+=(z.a=G=A[m+3])*P,E+=N,R+=_,p+=S,D+=G,z=z.next;for(J=q,K=F,i=0;r>i;i++)A[h+3]=G=w*L>>O,0!=G?(G=255/G,A[h]=(d*L>>O)*G,A[h+1]=(v*L>>O)*G,A[h+2]=(B*L>>O)*G):A[h]=A[h+1]=A[h+2]=0,d-=y,v-=I,B-=C,w-=k,y-=J.r,I-=J.g,C-=J.b,k-=J.a,m=x+((m=i+l+1)<U?m:U)<<2,E+=J.r=A[m],R+=J.g=A[m+1],p+=J.b=A[m+2],D+=J.a=A[m+3],d+=E,v+=R,B+=p,w+=D,J=J.next,y+=N=K.r,I+=_=K.g,C+=S=K.b,k+=G=K.a,E-=N,R-=_,p-=S,D-=G,K=K.next,h+=4;x+=r}for(i=0;r>i;i++){for(R=p=D=E=v=B=w=d=0,h=i<<2,y=W*(N=A[h]),I=W*(_=A[h+1]),C=W*(S=A[h+2]),k=W*(G=A[h+3]),d+=j*N,v+=j*_,B+=j*S,w+=j*G,z=q,b=0;W>b;b++)z.r=N,z.g=_,z.b=S,z.a=G,z=z.next;for(f=r,b=1;l>=b;b++)h=f+i<<2,d+=(z.r=N=A[h])*(P=W-b),v+=(z.g=_=A[h+1])*P,B+=(z.b=S=A[h+2])*P,w+=(z.a=G=A[h+3])*P,E+=N,R+=_,p+=S,D+=G,z=z.next,H>b&&(f+=r);for(h=i,J=q,K=F,u=0;n>u;u++)m=h<<2,A[m+3]=G=w*L>>O,G>0?(G=255/G,A[m]=(d*L>>O)*G,A[m+1]=(v*L>>O)*G,A[m+2]=(B*L>>O)*G):A[m]=A[m+1]=A[m+2]=0,d-=y,v-=I,B-=C,w-=k,y-=J.r,I-=J.g,C-=J.b,k-=J.a,m=i+((m=u+W)<H?m:H)*r<<2,d+=E+=J.r=A[m],v+=R+=J.g=A[m+1],B+=p+=J.b=A[m+2],w+=D+=J.a=A[m+3],J=J.next,y+=N=K.r,I+=_=K.g,C+=S=K.b,k+=G=K.a,E-=N,R-=_,p-=S,D-=G,K=K.next,h+=r}o.putImageData(g,t,e)}}function stackBlurCanvasRGB(a,t,e,r,n,l){if(!(isNaN(l)||1>l)){l|=0;var g,c=document.getElementById(a),o=c.getContext("2d");try{try{g=o.getImageData(t,e,r,n)}catch(s){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),g=o.getImageData(t,e,r,n)}catch(s){throw alert("Cannot access local image"),new Error("unable to access local image data: "+s)}}}catch(s){throw alert("Cannot access image"),new Error("unable to access image data: "+s)}var i,u,b,m,f,h,x,d,v,B,w,y,I,C,k,E,R,p,D,N,_=g.data,S=l+l+1,G=r-1,P=n-1,A=l+1,M=A*(A+1)/2,U=new BlurStack,H=U;for(b=1;S>b;b++)if(H=H.next=new BlurStack,b==A)var W=H;H.next=U;var j=null,q=null;x=h=0;var z=mul_table[l],F=shg_table[l];for(u=0;n>u;u++){for(C=k=E=d=v=B=0,w=A*(R=_[h]),y=A*(p=_[h+1]),I=A*(D=_[h+2]),d+=M*R,v+=M*p,B+=M*D,H=U,b=0;A>b;b++)H.r=R,H.g=p,H.b=D,H=H.next;for(b=1;A>b;b++)m=h+((b>G?G:b)<<2),d+=(H.r=R=_[m])*(N=A-b),v+=(H.g=p=_[m+1])*N,B+=(H.b=D=_[m+2])*N,C+=R,k+=p,E+=D,H=H.next;for(j=U,q=W,i=0;r>i;i++)_[h]=d*z>>F,_[h+1]=v*z>>F,_[h+2]=B*z>>F,d-=w,v-=y,B-=I,w-=j.r,y-=j.g,I-=j.b,m=x+((m=i+l+1)<G?m:G)<<2,C+=j.r=_[m],k+=j.g=_[m+1],E+=j.b=_[m+2],d+=C,v+=k,B+=E,j=j.next,w+=R=q.r,y+=p=q.g,I+=D=q.b,C-=R,k-=p,E-=D,q=q.next,h+=4;x+=r}for(i=0;r>i;i++){for(k=E=C=v=B=d=0,h=i<<2,w=A*(R=_[h]),y=A*(p=_[h+1]),I=A*(D=_[h+2]),d+=M*R,v+=M*p,B+=M*D,H=U,b=0;A>b;b++)H.r=R,H.g=p,H.b=D,H=H.next;for(f=r,b=1;l>=b;b++)h=f+i<<2,d+=(H.r=R=_[h])*(N=A-b),v+=(H.g=p=_[h+1])*N,B+=(H.b=D=_[h+2])*N,C+=R,k+=p,E+=D,H=H.next,P>b&&(f+=r);for(h=i,j=U,q=W,u=0;n>u;u++)m=h<<2,_[m]=d*z>>F,_[m+1]=v*z>>F,_[m+2]=B*z>>F,d-=w,v-=y,B-=I,w-=j.r,y-=j.g,I-=j.b,m=i+((m=u+A)<P?m:P)*r<<2,d+=C+=j.r=_[m],v+=k+=j.g=_[m+1],B+=E+=j.b=_[m+2],j=j.next,w+=R=q.r,y+=p=q.g,I+=D=q.b,C-=R,k-=p,E-=D,q=q.next,h+=r}o.putImageData(g,t,e)}}function BlurStack(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}var mul_table=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],shg_table=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];
!function(){function t(){var t={};return t.FRAMERATE=30,t.MAX_VIRTUAL_PIXELS=3e4,t.init=function(e){var i=0;t.UniqueId=function(){return i++,"canvg"+i},t.Definitions={},t.Styles={},t.Animations=[],t.Images=[],t.ctx=e,t.ViewPort=new function(){this.viewPorts=[],this.Clear=function(){this.viewPorts=[]},this.SetCurrent=function(t,e){this.viewPorts.push({width:t,height:e})},this.RemoveCurrent=function(){this.viewPorts.pop()},this.Current=function(){return this.viewPorts[this.viewPorts.length-1]},this.width=function(){return this.Current().width},this.height=function(){return this.Current().height},this.ComputeSize=function(t){return null!=t&&"number"==typeof t?t:"x"==t?this.width():"y"==t?this.height():Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2)}}},t.init(),t.ImagesLoaded=function(){for(var e=0;e<t.Images.length;e++)if(!t.Images[e].loaded)return!1;return!0},t.trim=function(t){return t.replace(/^\s+|\s+$/g,"")},t.compressSpaces=function(t){return t.replace(/[\s\r\t\n]+/gm," ")},t.ajax=function(t){var e;return e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),e?(e.open("GET",t,!1),e.send(null),e.responseText):null},t.parseXml=function(t){if(window.DOMParser){var e=new DOMParser;return e.parseFromString(t,"text/xml")}t=t.replace(/<!DOCTYPE svg[^>]*>/,"");var i=new ActiveXObject("Microsoft.XMLDOM");return i.async="false",i.loadXML(t),i},t.Property=function(t,e){this.name=t,this.value=e},t.Property.prototype.getValue=function(){return this.value},t.Property.prototype.hasValue=function(){return null!=this.value&&""!==this.value},t.Property.prototype.numValue=function(){if(!this.hasValue())return 0;var t=parseFloat(this.value);return(this.value+"").match(/%$/)&&(t/=100),t},t.Property.prototype.valueOrDefault=function(t){return this.hasValue()?this.value:t},t.Property.prototype.numValueOrDefault=function(t){return this.hasValue()?this.numValue():t},t.Property.prototype.addOpacity=function(e){var i=this.value;if(null!=e&&""!=e&&"string"==typeof this.value){var n=new RGBColor(this.value);n.ok&&(i="rgba("+n.r+", "+n.g+", "+n.b+", "+e+")")}return new t.Property(this.name,i)},t.Property.prototype.getDefinition=function(){var e=this.value.match(/#([^\)'"]+)/);return e&&(e=e[1]),e||(e=this.value),t.Definitions[e]},t.Property.prototype.isUrlDefinition=function(){return 0==this.value.indexOf("url(")},t.Property.prototype.getFillStyleDefinition=function(e,i){var n=this.getDefinition();if(null!=n&&n.createGradient)return n.createGradient(t.ctx,e,i);if(null!=n&&n.createPattern){if(n.getHrefAttribute().hasValue()){var s=n.attribute("patternTransform");n=n.getHrefAttribute().getDefinition(),s.hasValue()&&(n.attribute("patternTransform",!0).value=s.value)}return n.createPattern(t.ctx,e)}return null},t.Property.prototype.getDPI=function(){return 96},t.Property.prototype.getEM=function(e){var i=12,n=new t.Property("fontSize",t.Font.Parse(t.ctx.font).fontSize);return n.hasValue()&&(i=n.toPixels(e)),i},t.Property.prototype.getUnits=function(){var t=this.value+"";return t.replace(/[0-9\.\-]/g,"")},t.Property.prototype.toPixels=function(e,i){if(!this.hasValue())return 0;var n=this.value+"";if(n.match(/em$/))return this.numValue()*this.getEM(e);if(n.match(/ex$/))return this.numValue()*this.getEM(e)/2;if(n.match(/px$/))return this.numValue();if(n.match(/pt$/))return this.numValue()*this.getDPI(e)*(1/72);if(n.match(/pc$/))return 15*this.numValue();if(n.match(/cm$/))return this.numValue()*this.getDPI(e)/2.54;if(n.match(/mm$/))return this.numValue()*this.getDPI(e)/25.4;if(n.match(/in$/))return this.numValue()*this.getDPI(e);if(n.match(/%$/))return this.numValue()*t.ViewPort.ComputeSize(e);var s=this.numValue();return i&&1>s?s*t.ViewPort.ComputeSize(e):s},t.Property.prototype.toMilliseconds=function(){if(!this.hasValue())return 0;var t=this.value+"";return t.match(/s$/)?1e3*this.numValue():(t.match(/ms$/),this.numValue())},t.Property.prototype.toRadians=function(){if(!this.hasValue())return 0;var t=this.value+"";return t.match(/deg$/)?this.numValue()*(Math.PI/180):t.match(/grad$/)?this.numValue()*(Math.PI/200):t.match(/rad$/)?this.numValue():this.numValue()*(Math.PI/180)},t.Font=new function(){this.Styles="normal|italic|oblique|inherit",this.Variants="normal|small-caps|inherit",this.Weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit",this.CreateFont=function(e,i,n,s,a,r){var o=null!=r?this.Parse(r):this.CreateFont("","","","","",t.ctx.font);return{fontFamily:a||o.fontFamily,fontSize:s||o.fontSize,fontStyle:e||o.fontStyle,fontWeight:n||o.fontWeight,fontVariant:i||o.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(" ")}}};var e=this;this.Parse=function(i){for(var n={},s=t.trim(t.compressSpaces(i||"")).split(" "),a={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1},r="",o=0;o<s.length;o++)a.fontStyle||-1==e.Styles.indexOf(s[o])?a.fontVariant||-1==e.Variants.indexOf(s[o])?a.fontWeight||-1==e.Weights.indexOf(s[o])?a.fontSize?"inherit"!=s[o]&&(r+=s[o]):("inherit"!=s[o]&&(n.fontSize=s[o].split("/")[0]),a.fontStyle=a.fontVariant=a.fontWeight=a.fontSize=!0):("inherit"!=s[o]&&(n.fontWeight=s[o]),a.fontStyle=a.fontVariant=a.fontWeight=!0):("inherit"!=s[o]&&(n.fontVariant=s[o]),a.fontStyle=a.fontVariant=!0):("inherit"!=s[o]&&(n.fontStyle=s[o]),a.fontStyle=!0);return""!=r&&(n.fontFamily=r),n}},t.ToNumberArray=function(e){for(var i=t.trim(t.compressSpaces((e||"").replace(/,/g," "))).split(" "),n=0;n<i.length;n++)i[n]=parseFloat(i[n]);return i},t.Point=function(t,e){this.x=t,this.y=e},t.Point.prototype.angleTo=function(t){return Math.atan2(t.y-this.y,t.x-this.x)},t.Point.prototype.applyTransform=function(t){var e=this.x*t[0]+this.y*t[2]+t[4],i=this.x*t[1]+this.y*t[3]+t[5];this.x=e,this.y=i},t.CreatePoint=function(e){var i=t.ToNumberArray(e);return new t.Point(i[0],i[1])},t.CreatePath=function(e){for(var i=t.ToNumberArray(e),n=[],s=0;s<i.length;s+=2)n.push(new t.Point(i[s],i[s+1]));return n},t.BoundingBox=function(t,e,n,s){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN,this.x=function(){return this.x1},this.y=function(){return this.y1},this.width=function(){return this.x2-this.x1},this.height=function(){return this.y2-this.y1},this.addPoint=function(t,e){null!=t&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=t,this.x2=t),t<this.x1&&(this.x1=t),t>this.x2&&(this.x2=t)),null!=e&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))},this.addX=function(t){this.addPoint(t,null)},this.addY=function(t){this.addPoint(null,t)},this.addBoundingBox=function(t){this.addPoint(t.x1,t.y1),this.addPoint(t.x2,t.y2)},this.addQuadraticCurve=function(t,e,i,n,s,a){var r=t+2/3*(i-t),o=e+2/3*(n-e),l=r+1/3*(s-t),h=o+1/3*(a-e);this.addBezierCurve(t,e,r,l,o,h,s,a)},this.addBezierCurve=function(t,e,n,s,a,r,o,l){var h=[t,e],u=[n,s],c=[a,r],f=[o,l];for(this.addPoint(h[0],h[1]),this.addPoint(f[0],f[1]),i=0;1>=i;i++){var m=function(t){return Math.pow(1-t,3)*h[i]+3*Math.pow(1-t,2)*t*u[i]+3*(1-t)*Math.pow(t,2)*c[i]+Math.pow(t,3)*f[i]},d=6*h[i]-12*u[i]+6*c[i],p=-3*h[i]+9*u[i]-9*c[i]+3*f[i],y=3*u[i]-3*h[i];if(0!=p){var v=Math.pow(d,2)-4*y*p;if(!(0>v)){var g=(-d+Math.sqrt(v))/(2*p);g>0&&1>g&&(0==i&&this.addX(m(g)),1==i&&this.addY(m(g)));var x=(-d-Math.sqrt(v))/(2*p);x>0&&1>x&&(0==i&&this.addX(m(x)),1==i&&this.addY(m(x)))}}else{if(0==d)continue;var b=-y/d;b>0&&1>b&&(0==i&&this.addX(m(b)),1==i&&this.addY(m(b)))}}},this.isPointInBox=function(t,e){return this.x1<=t&&t<=this.x2&&this.y1<=e&&e<=this.y2},this.addPoint(t,e),this.addPoint(n,s)},t.Transform=function(e){var i=this;this.Type={},this.Type.translate=function(e){this.p=t.CreatePoint(e),this.apply=function(t){t.translate(this.p.x||0,this.p.y||0)},this.unapply=function(t){t.translate(-1*this.p.x||0,-1*this.p.y||0)},this.applyToPoint=function(t){t.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0])}},this.Type.rotate=function(e){var i=t.ToNumberArray(e);this.angle=new t.Property("angle",i[0]),this.cx=i[1]||0,this.cy=i[2]||0,this.apply=function(t){t.translate(this.cx,this.cy),t.rotate(this.angle.toRadians()),t.translate(-this.cx,-this.cy)},this.unapply=function(t){t.translate(this.cx,this.cy),t.rotate(-1*this.angle.toRadians()),t.translate(-this.cx,-this.cy)},this.applyToPoint=function(t){var e=this.angle.toRadians();t.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]),t.applyTransform([Math.cos(e),Math.sin(e),-Math.sin(e),Math.cos(e),0,0]),t.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0])}},this.Type.scale=function(e){this.p=t.CreatePoint(e),this.apply=function(t){t.scale(this.p.x||1,this.p.y||this.p.x||1)},this.unapply=function(t){t.scale(1/this.p.x||1,1/this.p.y||this.p.x||1)},this.applyToPoint=function(t){t.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0])}},this.Type.matrix=function(e){this.m=t.ToNumberArray(e),this.apply=function(t){t.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])},this.applyToPoint=function(t){t.applyTransform(this.m)}},this.Type.SkewBase=function(e){this.base=i.Type.matrix,this.base(e),this.angle=new t.Property("angle",e)},this.Type.SkewBase.prototype=new this.Type.matrix,this.Type.skewX=function(t){this.base=i.Type.SkewBase,this.base(t),this.m=[1,0,Math.tan(this.angle.toRadians()),1,0,0]},this.Type.skewX.prototype=new this.Type.SkewBase,this.Type.skewY=function(t){this.base=i.Type.SkewBase,this.base(t),this.m=[1,Math.tan(this.angle.toRadians()),0,1,0,0]},this.Type.skewY.prototype=new this.Type.SkewBase,this.transforms=[],this.apply=function(t){for(var e=0;e<this.transforms.length;e++)this.transforms[e].apply(t)},this.unapply=function(t){for(var e=this.transforms.length-1;e>=0;e--)this.transforms[e].unapply(t)},this.applyToPoint=function(t){for(var e=0;e<this.transforms.length;e++)this.transforms[e].applyToPoint(t)};for(var n=t.trim(t.compressSpaces(e)).replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/),s=0;s<n.length;s++){var a=t.trim(n[s].split("(")[0]),r=n[s].split("(")[1].replace(")",""),o=new this.Type[a](r);o.type=a,this.transforms.push(o)}},t.AspectRatio=function(e,i,n,s,a,r,o,l,h,u){i=t.compressSpaces(i),i=i.replace(/^defer\s/,"");var c=i.split(" ")[0]||"xMidYMid",f=i.split(" ")[1]||"meet",m=n/s,d=a/r,p=Math.min(m,d),y=Math.max(m,d);"meet"==f&&(s*=p,r*=p),"slice"==f&&(s*=y,r*=y),h=new t.Property("refX",h),u=new t.Property("refY",u),h.hasValue()&&u.hasValue()?e.translate(-p*h.toPixels("x"),-p*u.toPixels("y")):(c.match(/^xMid/)&&("meet"==f&&p==d||"slice"==f&&y==d)&&e.translate(n/2-s/2,0),c.match(/YMid$/)&&("meet"==f&&p==m||"slice"==f&&y==m)&&e.translate(0,a/2-r/2),c.match(/^xMax/)&&("meet"==f&&p==d||"slice"==f&&y==d)&&e.translate(n-s,0),c.match(/YMax$/)&&("meet"==f&&p==m||"slice"==f&&y==m)&&e.translate(0,a-r)),"none"==c?e.scale(m,d):"meet"==f?e.scale(p,p):"slice"==f&&e.scale(y,y),e.translate(null==o?0:-o,null==l?0:-l)},t.Element={},t.EmptyProperty=new t.Property("EMPTY",""),t.Element.ElementBase=function(e){if(this.attributes={},this.styles={},this.children=[],this.attribute=function(e,i){var n=this.attributes[e];return null!=n?n:(1==i&&(n=new t.Property(e,""),this.attributes[e]=n),n||t.EmptyProperty)},this.getHrefAttribute=function(){for(var e in this.attributes)if(e.match(/:href$/))return this.attributes[e];return t.EmptyProperty},this.style=function(e,i){var n=this.styles[e];if(null!=n)return n;var s=this.attribute(e);if(null!=s&&s.hasValue())return this.styles[e]=s,s;var a=this.parent;if(null!=a){var r=a.style(e);if(null!=r&&r.hasValue())return r}return 1==i&&(n=new t.Property(e,""),this.styles[e]=n),n||t.EmptyProperty},this.render=function(t){if("none"!=this.style("display").value&&"hidden"!=this.attribute("visibility").value){if(t.save(),this.attribute("mask").hasValue()){var e=this.attribute("mask").getDefinition();null!=e&&e.apply(t,this)}else if(this.style("filter").hasValue()){var i=this.style("filter").getDefinition();null!=i&&i.apply(t,this)}else this.setContext(t),this.renderChildren(t),this.clearContext(t);t.restore()}},this.setContext=function(){},this.clearContext=function(){},this.renderChildren=function(t){for(var e=0;e<this.children.length;e++)this.children[e].render(t)},this.addChild=function(e,i){var n=e;i&&(n=t.CreateElement(e)),n.parent=this,this.children.push(n)},null!=e&&1==e.nodeType){for(var i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];if(1==n.nodeType&&this.addChild(n,!0),this.captureTextNodes&&3==n.nodeType){var s=n.nodeValue||n.text||"";""!=t.trim(t.compressSpaces(s))&&this.addChild(new t.Element.tspan(n),!1)}}for(var i=0;i<e.attributes.length;i++){var a=e.attributes[i];this.attributes[a.nodeName]=new t.Property(a.nodeName,a.nodeValue)}var r=t.Styles[e.nodeName];if(null!=r)for(var o in r)this.styles[o]=r[o];if(this.attribute("class").hasValue())for(var l=t.compressSpaces(this.attribute("class").value).split(" "),h=0;h<l.length;h++){if(r=t.Styles["."+l[h]],null!=r)for(var o in r)this.styles[o]=r[o];if(r=t.Styles[e.nodeName+"."+l[h]],null!=r)for(var o in r)this.styles[o]=r[o]}if(this.attribute("id").hasValue()){var r=t.Styles["#"+this.attribute("id").value];if(null!=r)for(var o in r)this.styles[o]=r[o]}if(this.attribute("style").hasValue())for(var r=this.attribute("style").value.split(";"),i=0;i<r.length;i++)if(""!=t.trim(r[i])){var u=r[i].split(":"),o=t.trim(u[0]),c=t.trim(u[1]);this.styles[o]=new t.Property(o,c)}this.attribute("id").hasValue()&&null==t.Definitions[this.attribute("id").value]&&(t.Definitions[this.attribute("id").value]=this)}},t.Element.RenderedElementBase=function(e){this.base=t.Element.ElementBase,this.base(e),this.setContext=function(e){if(this.style("fill").isUrlDefinition()){var i=this.style("fill").getFillStyleDefinition(this,this.style("fill-opacity"));null!=i&&(e.fillStyle=i)}else if(this.style("fill").hasValue()){var n=this.style("fill");"currentColor"==n.value&&(n.value=this.style("color").value),e.fillStyle="none"==n.value?"rgba(0,0,0,0)":n.value}if(this.style("fill-opacity").hasValue()){var n=new t.Property("fill",e.fillStyle);n=n.addOpacity(this.style("fill-opacity").value),e.fillStyle=n.value}if(this.style("stroke").isUrlDefinition()){var i=this.style("stroke").getFillStyleDefinition(this,this.style("stroke-opacity"));null!=i&&(e.strokeStyle=i)}else if(this.style("stroke").hasValue()){var s=this.style("stroke");"currentColor"==s.value&&(s.value=this.style("color").value),e.strokeStyle="none"==s.value?"rgba(0,0,0,0)":s.value}if(this.style("stroke-opacity").hasValue()){var s=new t.Property("stroke",e.strokeStyle);s=s.addOpacity(this.style("stroke-opacity").value),e.strokeStyle=s.value}if(this.style("stroke-width").hasValue()){var a=this.style("stroke-width").toPixels();e.lineWidth=0==a?.001:a}if(this.style("stroke-linecap").hasValue()&&(e.lineCap=this.style("stroke-linecap").value),this.style("stroke-linejoin").hasValue()&&(e.lineJoin=this.style("stroke-linejoin").value),this.style("stroke-miterlimit").hasValue()&&(e.miterLimit=this.style("stroke-miterlimit").value),this.style("stroke-dasharray").hasValue()){var r=t.ToNumberArray(this.style("stroke-dasharray").value);"undefined"!=typeof e.setLineDash?e.setLineDash(r):"undefined"!=typeof e.webkitLineDash?e.webkitLineDash=r:"undefined"!=typeof e.mozDash&&(e.mozDash=r);var o=this.style("stroke-dashoffset").numValueOrDefault(1);"undefined"!=typeof e.lineDashOffset?e.lineDashOffset=o:"undefined"!=typeof e.webkitLineDashOffset?e.webkitLineDashOffset=o:"undefined"!=typeof e.mozDashOffset&&(e.mozDashOffset=o)}if("undefined"!=typeof e.font&&(e.font=t.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").toPixels()+"px":"",this.style("font-family").value).toString()),this.attribute("transform").hasValue()){var l=new t.Transform(this.attribute("transform").value);l.apply(e)}if(this.style("clip-path").hasValue()){var h=this.style("clip-path").getDefinition();null!=h&&h.apply(e)}this.style("opacity").hasValue()&&(e.globalAlpha=this.style("opacity").numValue())}},t.Element.RenderedElementBase.prototype=new t.Element.ElementBase,t.Element.PathElementBase=function(e){this.base=t.Element.RenderedElementBase,this.base(e),this.path=function(e){return null!=e&&e.beginPath(),new t.BoundingBox},this.renderChildren=function(e){this.path(e),t.Mouse.checkPath(this,e),""!=e.fillStyle&&(this.attribute("fill-rule").hasValue()?e.fill(this.attribute("fill-rule").value):e.fill()),""!=e.strokeStyle&&e.stroke();var i=this.getMarkers();if(null!=i){if(this.style("marker-start").isUrlDefinition()){var n=this.style("marker-start").getDefinition();n.render(e,i[0][0],i[0][1])}if(this.style("marker-mid").isUrlDefinition())for(var n=this.style("marker-mid").getDefinition(),s=1;s<i.length-1;s++)n.render(e,i[s][0],i[s][1]);if(this.style("marker-end").isUrlDefinition()){var n=this.style("marker-end").getDefinition();n.render(e,i[i.length-1][0],i[i.length-1][1])}}},this.getBoundingBox=function(){return this.path()},this.getMarkers=function(){return null}},t.Element.PathElementBase.prototype=new t.Element.RenderedElementBase,t.Element.svg=function(e){this.base=t.Element.RenderedElementBase,this.base(e),this.baseClearContext=this.clearContext,this.clearContext=function(e){this.baseClearContext(e),t.ViewPort.RemoveCurrent()},this.baseSetContext=this.setContext,this.setContext=function(e){e.strokeStyle="rgba(0,0,0,0)",e.lineCap="butt",e.lineJoin="miter",e.miterLimit=4,this.baseSetContext(e),this.attribute("x").hasValue()||(this.attribute("x",!0).value=0),this.attribute("y").hasValue()||(this.attribute("y",!0).value=0),e.translate(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"));var i=t.ViewPort.width(),n=t.ViewPort.height();if(this.attribute("width").hasValue()||(this.attribute("width",!0).value="100%"),this.attribute("height").hasValue()||(this.attribute("height",!0).value="100%"),"undefined"==typeof this.root){i=this.attribute("width").toPixels("x"),n=this.attribute("height").toPixels("y");var s=0,a=0;this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()&&(s=-this.attribute("refX").toPixels("x"),a=-this.attribute("refY").toPixels("y")),e.beginPath(),e.moveTo(s,a),e.lineTo(i,a),e.lineTo(i,n),e.lineTo(s,n),e.closePath(),e.clip()}if(t.ViewPort.SetCurrent(i,n),this.attribute("viewBox").hasValue()){var r=t.ToNumberArray(this.attribute("viewBox").value),o=r[0],l=r[1];i=r[2],n=r[3],t.AspectRatio(e,this.attribute("preserveAspectRatio").value,t.ViewPort.width(),i,t.ViewPort.height(),n,o,l,this.attribute("refX").value,this.attribute("refY").value),t.ViewPort.RemoveCurrent(),t.ViewPort.SetCurrent(r[2],r[3])}}},t.Element.svg.prototype=new t.Element.RenderedElementBase,t.Element.rect=function(e){this.base=t.Element.PathElementBase,this.base(e),this.path=function(e){var i=this.attribute("x").toPixels("x"),n=this.attribute("y").toPixels("y"),s=this.attribute("width").toPixels("x"),a=this.attribute("height").toPixels("y"),r=this.attribute("rx").toPixels("x"),o=this.attribute("ry").toPixels("y");return this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue()&&(o=r),this.attribute("ry").hasValue()&&!this.attribute("rx").hasValue()&&(r=o),r=Math.min(r,s/2),o=Math.min(o,a/2),null!=e&&(e.beginPath(),e.moveTo(i+r,n),e.lineTo(i+s-r,n),e.quadraticCurveTo(i+s,n,i+s,n+o),e.lineTo(i+s,n+a-o),e.quadraticCurveTo(i+s,n+a,i+s-r,n+a),e.lineTo(i+r,n+a),e.quadraticCurveTo(i,n+a,i,n+a-o),e.lineTo(i,n+o),e.quadraticCurveTo(i,n,i+r,n),e.closePath()),new t.BoundingBox(i,n,i+s,n+a)}},t.Element.rect.prototype=new t.Element.PathElementBase,t.Element.circle=function(e){this.base=t.Element.PathElementBase,this.base(e),this.path=function(e){var i=this.attribute("cx").toPixels("x"),n=this.attribute("cy").toPixels("y"),s=this.attribute("r").toPixels();return null!=e&&(e.beginPath(),e.arc(i,n,s,0,2*Math.PI,!0),e.closePath()),new t.BoundingBox(i-s,n-s,i+s,n+s)}},t.Element.circle.prototype=new t.Element.PathElementBase,t.Element.ellipse=function(e){this.base=t.Element.PathElementBase,this.base(e),this.path=function(e){var i=4*((Math.sqrt(2)-1)/3),n=this.attribute("rx").toPixels("x"),s=this.attribute("ry").toPixels("y"),a=this.attribute("cx").toPixels("x"),r=this.attribute("cy").toPixels("y");return null!=e&&(e.beginPath(),e.moveTo(a,r-s),e.bezierCurveTo(a+i*n,r-s,a+n,r-i*s,a+n,r),e.bezierCurveTo(a+n,r+i*s,a+i*n,r+s,a,r+s),e.bezierCurveTo(a-i*n,r+s,a-n,r+i*s,a-n,r),e.bezierCurveTo(a-n,r-i*s,a-i*n,r-s,a,r-s),e.closePath()),new t.BoundingBox(a-n,r-s,a+n,r+s)}},t.Element.ellipse.prototype=new t.Element.PathElementBase,t.Element.line=function(e){this.base=t.Element.PathElementBase,this.base(e),this.getPoints=function(){return[new t.Point(this.attribute("x1").toPixels("x"),this.attribute("y1").toPixels("y")),new t.Point(this.attribute("x2").toPixels("x"),this.attribute("y2").toPixels("y"))]},this.path=function(e){var i=this.getPoints();return null!=e&&(e.beginPath(),e.moveTo(i[0].x,i[0].y),e.lineTo(i[1].x,i[1].y)),new t.BoundingBox(i[0].x,i[0].y,i[1].x,i[1].y)},this.getMarkers=function(){var t=this.getPoints(),e=t[0].angleTo(t[1]);return[[t[0],e],[t[1],e]]}},t.Element.line.prototype=new t.Element.PathElementBase,t.Element.polyline=function(e){this.base=t.Element.PathElementBase,this.base(e),this.points=t.CreatePath(this.attribute("points").value),this.path=function(e){var i=new t.BoundingBox(this.points[0].x,this.points[0].y);null!=e&&(e.beginPath(),e.moveTo(this.points[0].x,this.points[0].y));for(var n=1;n<this.points.length;n++)i.addPoint(this.points[n].x,this.points[n].y),null!=e&&e.lineTo(this.points[n].x,this.points[n].y);return i},this.getMarkers=function(){for(var t=[],e=0;e<this.points.length-1;e++)t.push([this.points[e],this.points[e].angleTo(this.points[e+1])]);return t.push([this.points[this.points.length-1],t[t.length-1][1]]),t}},t.Element.polyline.prototype=new t.Element.PathElementBase,t.Element.polygon=function(e){this.base=t.Element.polyline,this.base(e),this.basePath=this.path,this.path=function(t){var e=this.basePath(t);return null!=t&&(t.lineTo(this.points[0].x,this.points[0].y),t.closePath()),e}},t.Element.polygon.prototype=new t.Element.polyline,t.Element.path=function(e){this.base=t.Element.PathElementBase,this.base(e);var i=this.attribute("d").value;i=i.replace(/,/gm," "),i=i.replace(/([MmZzLlHhVvCcSsQqTtAa])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),i=i.replace(/([MmZzLlHhVvCcSsQqTtAa])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),i=i.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2"),i=i.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),i=i.replace(/([0-9])([+\-])/gm,"$1 $2"),i=i.replace(/(\.[0-9]*)(\.)/gm,"$1 $2"),i=i.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 "),i=t.compressSpaces(i),i=t.trim(i),this.PathParser=new function(e){this.tokens=e.split(" "),this.reset=function(){this.i=-1,this.command="",this.previousCommand="",this.start=new t.Point(0,0),this.control=new t.Point(0,0),this.current=new t.Point(0,0),this.points=[],this.angles=[]},this.isEnd=function(){return this.i>=this.tokens.length-1},this.isCommandOrEnd=function(){return this.isEnd()?!0:null!=this.tokens[this.i+1].match(/^[A-Za-z]$/)},this.isRelativeCommand=function(){switch(this.command){case"m":case"l":case"h":case"v":case"c":case"s":case"q":case"t":case"a":case"z":return!0}return!1},this.getToken=function(){return this.i++,this.tokens[this.i]},this.getScalar=function(){return parseFloat(this.getToken())},this.nextCommand=function(){this.previousCommand=this.command,this.command=this.getToken()},this.getPoint=function(){var e=new t.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(e)},this.getAsControlPoint=function(){var t=this.getPoint();return this.control=t,t},this.getAsCurrentPoint=function(){var t=this.getPoint();return this.current=t,t},this.getReflectedControlPoint=function(){if("c"!=this.previousCommand.toLowerCase()&&"s"!=this.previousCommand.toLowerCase()&&"q"!=this.previousCommand.toLowerCase()&&"t"!=this.previousCommand.toLowerCase())return this.current;var e=new t.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y);return e},this.makeAbsolute=function(t){return this.isRelativeCommand()&&(t.x+=this.current.x,t.y+=this.current.y),t},this.addMarker=function(t,e,i){null!=i&&this.angles.length>0&&null==this.angles[this.angles.length-1]&&(this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(i)),this.addMarkerAngle(t,null==e?null:e.angleTo(t))},this.addMarkerAngle=function(t,e){this.points.push(t),this.angles.push(e)},this.getMarkerPoints=function(){return this.points},this.getMarkerAngles=function(){for(var t=0;t<this.angles.length;t++)if(null==this.angles[t])for(var e=t+1;e<this.angles.length;e++)if(null!=this.angles[e]){this.angles[t]=this.angles[e];break}return this.angles}}(i),this.path=function(e){var i=this.PathParser;i.reset();var n=new t.BoundingBox;for(null!=e&&e.beginPath();!i.isEnd();)switch(i.nextCommand(),i.command){case"M":case"m":var s=i.getAsCurrentPoint();for(i.addMarker(s),n.addPoint(s.x,s.y),null!=e&&e.moveTo(s.x,s.y),i.start=i.current;!i.isCommandOrEnd();){var s=i.getAsCurrentPoint();i.addMarker(s,i.start),n.addPoint(s.x,s.y),null!=e&&e.lineTo(s.x,s.y)}break;case"L":case"l":for(;!i.isCommandOrEnd();){var a=i.current,s=i.getAsCurrentPoint();i.addMarker(s,a),n.addPoint(s.x,s.y),null!=e&&e.lineTo(s.x,s.y)}break;case"H":case"h":for(;!i.isCommandOrEnd();){var r=new t.Point((i.isRelativeCommand()?i.current.x:0)+i.getScalar(),i.current.y);i.addMarker(r,i.current),i.current=r,n.addPoint(i.current.x,i.current.y),null!=e&&e.lineTo(i.current.x,i.current.y)}break;case"V":case"v":for(;!i.isCommandOrEnd();){var r=new t.Point(i.current.x,(i.isRelativeCommand()?i.current.y:0)+i.getScalar());i.addMarker(r,i.current),i.current=r,n.addPoint(i.current.x,i.current.y),null!=e&&e.lineTo(i.current.x,i.current.y)}break;case"C":case"c":for(;!i.isCommandOrEnd();){var o=i.current,l=i.getPoint(),h=i.getAsControlPoint(),u=i.getAsCurrentPoint();i.addMarker(u,h,l),n.addBezierCurve(o.x,o.y,l.x,l.y,h.x,h.y,u.x,u.y),null!=e&&e.bezierCurveTo(l.x,l.y,h.x,h.y,u.x,u.y)}break;case"S":case"s":for(;!i.isCommandOrEnd();){var o=i.current,l=i.getReflectedControlPoint(),h=i.getAsControlPoint(),u=i.getAsCurrentPoint();i.addMarker(u,h,l),n.addBezierCurve(o.x,o.y,l.x,l.y,h.x,h.y,u.x,u.y),null!=e&&e.bezierCurveTo(l.x,l.y,h.x,h.y,u.x,u.y)}break;case"Q":case"q":for(;!i.isCommandOrEnd();){var o=i.current,h=i.getAsControlPoint(),u=i.getAsCurrentPoint();i.addMarker(u,h,h),n.addQuadraticCurve(o.x,o.y,h.x,h.y,u.x,u.y),null!=e&&e.quadraticCurveTo(h.x,h.y,u.x,u.y)}break;case"T":case"t":for(;!i.isCommandOrEnd();){var o=i.current,h=i.getReflectedControlPoint();i.control=h;var u=i.getAsCurrentPoint();i.addMarker(u,h,h),n.addQuadraticCurve(o.x,o.y,h.x,h.y,u.x,u.y),null!=e&&e.quadraticCurveTo(h.x,h.y,u.x,u.y)}break;case"A":case"a":for(;!i.isCommandOrEnd();){var o=i.current,c=i.getScalar(),f=i.getScalar(),m=i.getScalar()*(Math.PI/180),d=i.getScalar(),p=i.getScalar(),u=i.getAsCurrentPoint(),y=new t.Point(Math.cos(m)*(o.x-u.x)/2+Math.sin(m)*(o.y-u.y)/2,-Math.sin(m)*(o.x-u.x)/2+Math.cos(m)*(o.y-u.y)/2),v=Math.pow(y.x,2)/Math.pow(c,2)+Math.pow(y.y,2)/Math.pow(f,2);v>1&&(c*=Math.sqrt(v),f*=Math.sqrt(v));var g=(d==p?-1:1)*Math.sqrt((Math.pow(c,2)*Math.pow(f,2)-Math.pow(c,2)*Math.pow(y.y,2)-Math.pow(f,2)*Math.pow(y.x,2))/(Math.pow(c,2)*Math.pow(y.y,2)+Math.pow(f,2)*Math.pow(y.x,2)));isNaN(g)&&(g=0);var x=new t.Point(g*c*y.y/f,g*-f*y.x/c),b=new t.Point((o.x+u.x)/2+Math.cos(m)*x.x-Math.sin(m)*x.y,(o.y+u.y)/2+Math.sin(m)*x.x+Math.cos(m)*x.y),E=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2))},P=function(t,e){return(t[0]*e[0]+t[1]*e[1])/(E(t)*E(e))},w=function(t,e){return(t[0]*e[1]<t[1]*e[0]?-1:1)*Math.acos(P(t,e))},B=w([1,0],[(y.x-x.x)/c,(y.y-x.y)/f]),C=[(y.x-x.x)/c,(y.y-x.y)/f],V=[(-y.x-x.x)/c,(-y.y-x.y)/f],T=w(C,V);P(C,V)<=-1&&(T=Math.PI),P(C,V)>=1&&(T=0);var M=1-p?1:-1,k=B+M*(T/2),S=new t.Point(b.x+c*Math.cos(k),b.y+f*Math.sin(k));if(i.addMarkerAngle(S,k-M*Math.PI/2),i.addMarkerAngle(u,k-M*Math.PI),n.addPoint(u.x,u.y),null!=e){var P=c>f?c:f,A=c>f?1:c/f,D=c>f?f/c:1;e.translate(b.x,b.y),e.rotate(m),e.scale(A,D),e.arc(0,0,P,B,B+T,1-p),e.scale(1/A,1/D),e.rotate(-m),e.translate(-b.x,-b.y)}}break;case"Z":case"z":null!=e&&e.closePath(),i.current=i.start}return n},this.getMarkers=function(){for(var t=this.PathParser.getMarkerPoints(),e=this.PathParser.getMarkerAngles(),i=[],n=0;n<t.length;n++)i.push([t[n],e[n]]);return i}},t.Element.path.prototype=new t.Element.PathElementBase,t.Element.pattern=function(e){this.base=t.Element.ElementBase,this.base(e),this.createPattern=function(e){var i=this.attribute("width").toPixels("x",!0),n=this.attribute("height").toPixels("y",!0),s=new t.Element.svg;s.attributes.viewBox=new t.Property("viewBox",this.attribute("viewBox").value),s.attributes.width=new t.Property("width",i+"px"),s.attributes.height=new t.Property("height",n+"px"),s.attributes.transform=new t.Property("transform",this.attribute("patternTransform").value),s.children=this.children;var a=document.createElement("canvas");a.width=i,a.height=n;var r=a.getContext("2d");this.attribute("x").hasValue()&&this.attribute("y").hasValue()&&r.translate(this.attribute("x").toPixels("x",!0),this.attribute("y").toPixels("y",!0));for(var o=-1;1>=o;o++)for(var l=-1;1>=l;l++)r.save(),r.translate(o*a.width,l*a.height),s.render(r),r.restore();var h=e.createPattern(a,"repeat");return h}},t.Element.pattern.prototype=new t.Element.ElementBase,t.Element.marker=function(e){this.base=t.Element.ElementBase,this.base(e),this.baseRender=this.render,this.render=function(e,i,n){e.translate(i.x,i.y),"auto"==this.attribute("orient").valueOrDefault("auto")&&e.rotate(n),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&e.scale(e.lineWidth,e.lineWidth),e.save();var s=new t.Element.svg;s.attributes.viewBox=new t.Property("viewBox",this.attribute("viewBox").value),s.attributes.refX=new t.Property("refX",this.attribute("refX").value),s.attributes.refY=new t.Property("refY",this.attribute("refY").value),s.attributes.width=new t.Property("width",this.attribute("markerWidth").value),s.attributes.height=new t.Property("height",this.attribute("markerHeight").value),s.attributes.fill=new t.Property("fill",this.attribute("fill").valueOrDefault("black")),s.attributes.stroke=new t.Property("stroke",this.attribute("stroke").valueOrDefault("none")),s.children=this.children,s.render(e),e.restore(),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&e.scale(1/e.lineWidth,1/e.lineWidth),"auto"==this.attribute("orient").valueOrDefault("auto")&&e.rotate(-n),e.translate(-i.x,-i.y)}},t.Element.marker.prototype=new t.Element.ElementBase,t.Element.defs=function(e){this.base=t.Element.ElementBase,this.base(e),this.render=function(){}},t.Element.defs.prototype=new t.Element.ElementBase,t.Element.GradientBase=function(e){this.base=t.Element.ElementBase,this.base(e),this.gradientUnits=this.attribute("gradientUnits").valueOrDefault("objectBoundingBox"),this.stops=[];for(var i=0;i<this.children.length;i++){var n=this.children[i];"stop"==n.type&&this.stops.push(n)}this.getGradient=function(){},this.createGradient=function(e,i,n){var s=this;this.getHrefAttribute().hasValue()&&(s=this.getHrefAttribute().getDefinition());var a=function(e){if(n.hasValue()){var i=new t.Property("color",e);return i.addOpacity(n.value).value}return e},r=this.getGradient(e,i);if(null==r)return a(s.stops[s.stops.length-1].color);for(var o=0;o<s.stops.length;o++)r.addColorStop(s.stops[o].offset,a(s.stops[o].color));if(this.attribute("gradientTransform").hasValue()){var l=t.ViewPort.viewPorts[0],h=new t.Element.rect;h.attributes.x=new t.Property("x",-t.MAX_VIRTUAL_PIXELS/3),h.attributes.y=new t.Property("y",-t.MAX_VIRTUAL_PIXELS/3),h.attributes.width=new t.Property("width",t.MAX_VIRTUAL_PIXELS),h.attributes.height=new t.Property("height",t.MAX_VIRTUAL_PIXELS);var u=new t.Element.g;u.attributes.transform=new t.Property("transform",this.attribute("gradientTransform").value),u.children=[h];
var c=new t.Element.svg;c.attributes.x=new t.Property("x",0),c.attributes.y=new t.Property("y",0),c.attributes.width=new t.Property("width",l.width),c.attributes.height=new t.Property("height",l.height),c.children=[u];var f=document.createElement("canvas");f.width=l.width,f.height=l.height;var m=f.getContext("2d");return m.fillStyle=r,c.render(m),m.createPattern(f,"no-repeat")}return r}},t.Element.GradientBase.prototype=new t.Element.ElementBase,t.Element.linearGradient=function(e){this.base=t.Element.GradientBase,this.base(e),this.getGradient=function(t,e){var i=e.getBoundingBox();this.attribute("x1").hasValue()||this.attribute("y1").hasValue()||this.attribute("x2").hasValue()||this.attribute("y2").hasValue()||(this.attribute("x1",!0).value=0,this.attribute("y1",!0).value=0,this.attribute("x2",!0).value=1,this.attribute("y2",!0).value=0);var n="objectBoundingBox"==this.gradientUnits?i.x()+i.width()*this.attribute("x1").numValue():this.attribute("x1").toPixels("x"),s="objectBoundingBox"==this.gradientUnits?i.y()+i.height()*this.attribute("y1").numValue():this.attribute("y1").toPixels("y"),a="objectBoundingBox"==this.gradientUnits?i.x()+i.width()*this.attribute("x2").numValue():this.attribute("x2").toPixels("x"),r="objectBoundingBox"==this.gradientUnits?i.y()+i.height()*this.attribute("y2").numValue():this.attribute("y2").toPixels("y");return n==a&&s==r?null:t.createLinearGradient(n,s,a,r)}},t.Element.linearGradient.prototype=new t.Element.GradientBase,t.Element.radialGradient=function(e){this.base=t.Element.GradientBase,this.base(e),this.getGradient=function(t,e){var i=e.getBoundingBox();this.attribute("cx").hasValue()||(this.attribute("cx",!0).value="50%"),this.attribute("cy").hasValue()||(this.attribute("cy",!0).value="50%"),this.attribute("r").hasValue()||(this.attribute("r",!0).value="50%");var n="objectBoundingBox"==this.gradientUnits?i.x()+i.width()*this.attribute("cx").numValue():this.attribute("cx").toPixels("x"),s="objectBoundingBox"==this.gradientUnits?i.y()+i.height()*this.attribute("cy").numValue():this.attribute("cy").toPixels("y"),a=n,r=s;this.attribute("fx").hasValue()&&(a="objectBoundingBox"==this.gradientUnits?i.x()+i.width()*this.attribute("fx").numValue():this.attribute("fx").toPixels("x")),this.attribute("fy").hasValue()&&(r="objectBoundingBox"==this.gradientUnits?i.y()+i.height()*this.attribute("fy").numValue():this.attribute("fy").toPixels("y"));var o="objectBoundingBox"==this.gradientUnits?(i.width()+i.height())/2*this.attribute("r").numValue():this.attribute("r").toPixels();return t.createRadialGradient(a,r,0,n,s,o)}},t.Element.radialGradient.prototype=new t.Element.GradientBase,t.Element.stop=function(e){this.base=t.Element.ElementBase,this.base(e),this.offset=this.attribute("offset").numValue(),this.offset<0&&(this.offset=0),this.offset>1&&(this.offset=1);var i=this.style("stop-color");this.style("stop-opacity").hasValue()&&(i=i.addOpacity(this.style("stop-opacity").value)),this.color=i.value},t.Element.stop.prototype=new t.Element.ElementBase,t.Element.AnimateBase=function(e){this.base=t.Element.ElementBase,this.base(e),t.Animations.push(this),this.duration=0,this.begin=this.attribute("begin").toMilliseconds(),this.maxDuration=this.begin+this.attribute("dur").toMilliseconds(),this.getProperty=function(){var t=this.attribute("attributeType").value,e=this.attribute("attributeName").value;return"CSS"==t?this.parent.style(e,!0):this.parent.attribute(e,!0)},this.initialValue=null,this.initialUnits="",this.removed=!1,this.calcValue=function(){return""},this.update=function(t){if(null==this.initialValue&&(this.initialValue=this.getProperty().value,this.initialUnits=this.getProperty().getUnits()),this.duration>this.maxDuration){if("indefinite"!=this.attribute("repeatCount").value&&"indefinite"!=this.attribute("repeatDur").value)return"remove"!=this.attribute("fill").valueOrDefault("remove")||this.removed?!1:(this.removed=!0,this.getProperty().value=this.initialValue,!0);this.duration=0}this.duration=this.duration+t;var e=!1;if(this.begin<this.duration){var i=this.calcValue();if(this.attribute("type").hasValue()){var n=this.attribute("type").value;i=n+"("+i+")"}this.getProperty().value=i,e=!0}return e},this.from=this.attribute("from"),this.to=this.attribute("to"),this.values=this.attribute("values"),this.values.hasValue()&&(this.values.value=this.values.value.split(";")),this.progress=function(){var e={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(this.values.hasValue()){var i=e.progress*(this.values.value.length-1),n=Math.floor(i),s=Math.ceil(i);e.from=new t.Property("from",parseFloat(this.values.value[n])),e.to=new t.Property("to",parseFloat(this.values.value[s])),e.progress=(i-n)/(s-n)}else e.from=this.from,e.to=this.to;return e}},t.Element.AnimateBase.prototype=new t.Element.ElementBase,t.Element.animate=function(e){this.base=t.Element.AnimateBase,this.base(e),this.calcValue=function(){var t=this.progress(),e=t.from.numValue()+(t.to.numValue()-t.from.numValue())*t.progress;return e+this.initialUnits}},t.Element.animate.prototype=new t.Element.AnimateBase,t.Element.animateColor=function(e){this.base=t.Element.AnimateBase,this.base(e),this.calcValue=function(){var t=this.progress(),e=new RGBColor(t.from.value),i=new RGBColor(t.to.value);if(e.ok&&i.ok){var n=e.r+(i.r-e.r)*t.progress,s=e.g+(i.g-e.g)*t.progress,a=e.b+(i.b-e.b)*t.progress;return"rgb("+parseInt(n,10)+","+parseInt(s,10)+","+parseInt(a,10)+")"}return this.attribute("from").value}},t.Element.animateColor.prototype=new t.Element.AnimateBase,t.Element.animateTransform=function(e){this.base=t.Element.AnimateBase,this.base(e),this.calcValue=function(){for(var e=this.progress(),i=t.ToNumberArray(e.from.value),n=t.ToNumberArray(e.to.value),s="",a=0;a<i.length;a++)s+=i[a]+(n[a]-i[a])*e.progress+" ";return s}},t.Element.animateTransform.prototype=new t.Element.animate,t.Element.font=function(e){this.base=t.Element.ElementBase,this.base(e),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.isRTL=!1,this.isArabic=!1,this.fontFace=null,this.missingGlyph=null,this.glyphs=[];for(var i=0;i<this.children.length;i++){var n=this.children[i];"font-face"==n.type?(this.fontFace=n,n.style("font-family").hasValue()&&(t.Definitions[n.style("font-family").value]=this)):"missing-glyph"==n.type?this.missingGlyph=n:"glyph"==n.type&&(""!=n.arabicForm?(this.isRTL=!0,this.isArabic=!0,"undefined"==typeof this.glyphs[n.unicode]&&(this.glyphs[n.unicode]=[]),this.glyphs[n.unicode][n.arabicForm]=n):this.glyphs[n.unicode]=n)}},t.Element.font.prototype=new t.Element.ElementBase,t.Element.fontface=function(e){this.base=t.Element.ElementBase,this.base(e),this.ascent=this.attribute("ascent").value,this.descent=this.attribute("descent").value,this.unitsPerEm=this.attribute("units-per-em").numValue()},t.Element.fontface.prototype=new t.Element.ElementBase,t.Element.missingglyph=function(e){this.base=t.Element.path,this.base(e),this.horizAdvX=0},t.Element.missingglyph.prototype=new t.Element.path,t.Element.glyph=function(e){this.base=t.Element.path,this.base(e),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.unicode=this.attribute("unicode").value,this.arabicForm=this.attribute("arabic-form").value},t.Element.glyph.prototype=new t.Element.path,t.Element.text=function(e){this.captureTextNodes=!0,this.base=t.Element.RenderedElementBase,this.base(e),this.baseSetContext=this.setContext,this.setContext=function(t){this.baseSetContext(t),this.style("dominant-baseline").hasValue()&&(t.textBaseline=this.style("dominant-baseline").value),this.style("alignment-baseline").hasValue()&&(t.textBaseline=this.style("alignment-baseline").value)},this.getBoundingBox=function(){return new t.BoundingBox(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"),0,0)},this.renderChildren=function(t){this.x=this.attribute("x").toPixels("x"),this.y=this.attribute("y").toPixels("y"),this.x+=this.getAnchorDelta(t,this,0);for(var e=0;e<this.children.length;e++)this.renderChild(t,this,e)},this.getAnchorDelta=function(t,e,i){var n=this.style("text-anchor").valueOrDefault("start");if("start"!=n){for(var s=0,a=i;a<e.children.length;a++){var r=e.children[a];if(a>i&&r.attribute("x").hasValue())break;s+=r.measureTextRecursive(t)}return-1*("end"==n?s:s/2)}return 0},this.renderChild=function(t,e,i){var n=e.children[i];n.attribute("x").hasValue()?n.x=n.attribute("x").toPixels("x")+this.getAnchorDelta(t,e,i):(this.attribute("dx").hasValue()&&(this.x+=this.attribute("dx").toPixels("x")),n.attribute("dx").hasValue()&&(this.x+=n.attribute("dx").toPixels("x")),n.x=this.x),this.x=n.x+n.measureText(t),n.attribute("y").hasValue()?n.y=n.attribute("y").toPixels("y"):(this.attribute("dy").hasValue()&&(this.y+=this.attribute("dy").toPixels("y")),n.attribute("dy").hasValue()&&(this.y+=n.attribute("dy").toPixels("y")),n.y=this.y),this.y=n.y,n.render(t);for(var i=0;i<n.children.length;i++)this.renderChild(t,n,i)}},t.Element.text.prototype=new t.Element.RenderedElementBase,t.Element.TextElementBase=function(e){this.base=t.Element.RenderedElementBase,this.base(e),this.getGlyph=function(t,e,i){var n=e[i],s=null;if(t.isArabic){var a="isolated";(0==i||" "==e[i-1])&&i<e.length-2&&" "!=e[i+1]&&(a="terminal"),i>0&&" "!=e[i-1]&&i<e.length-2&&" "!=e[i+1]&&(a="medial"),i>0&&" "!=e[i-1]&&(i==e.length-1||" "==e[i+1])&&(a="initial"),"undefined"!=typeof t.glyphs[n]&&(s=t.glyphs[n][a],null==s&&"glyph"==t.glyphs[n].type&&(s=t.glyphs[n]))}else s=t.glyphs[n];return null==s&&(s=t.missingGlyph),s},this.renderChildren=function(e){var i=this.parent.style("font-family").getDefinition();if(null==i)""!=e.fillStyle&&e.fillText(t.compressSpaces(this.getText()),this.x,this.y),""!=e.strokeStyle&&e.strokeText(t.compressSpaces(this.getText()),this.x,this.y);else{var n=this.parent.style("font-size").numValueOrDefault(t.Font.Parse(t.ctx.font).fontSize),s=this.parent.style("font-style").valueOrDefault(t.Font.Parse(t.ctx.font).fontStyle),a=this.getText();i.isRTL&&(a=a.split("").reverse().join(""));for(var r=t.ToNumberArray(this.parent.attribute("dx").value),o=0;o<a.length;o++){var l=this.getGlyph(i,a,o),h=n/i.fontFace.unitsPerEm;e.translate(this.x,this.y),e.scale(h,-h);var u=e.lineWidth;e.lineWidth=e.lineWidth*i.fontFace.unitsPerEm/n,"italic"==s&&e.transform(1,0,.4,1,0,0),l.render(e),"italic"==s&&e.transform(1,0,-.4,1,0,0),e.lineWidth=u,e.scale(1/h,-1/h),e.translate(-this.x,-this.y),this.x+=n*(l.horizAdvX||i.horizAdvX)/i.fontFace.unitsPerEm,"undefined"==typeof r[o]||isNaN(r[o])||(this.x+=r[o])}}},this.getText=function(){},this.measureTextRecursive=function(t){for(var e=this.measureText(t),i=0;i<this.children.length;i++)e+=this.children[i].measureTextRecursive(t);return e},this.measureText=function(e){var i=this.parent.style("font-family").getDefinition();if(null!=i){var n=this.parent.style("font-size").numValueOrDefault(t.Font.Parse(t.ctx.font).fontSize),s=0,a=this.getText();i.isRTL&&(a=a.split("").reverse().join(""));for(var r=t.ToNumberArray(this.parent.attribute("dx").value),o=0;o<a.length;o++){var l=this.getGlyph(i,a,o);s+=(l.horizAdvX||i.horizAdvX)*n/i.fontFace.unitsPerEm,"undefined"==typeof r[o]||isNaN(r[o])||(s+=r[o])}return s}var h=t.compressSpaces(this.getText());if(!e.measureText)return 10*h.length;e.save(),this.setContext(e);var u=e.measureText(h).width;return e.restore(),u}},t.Element.TextElementBase.prototype=new t.Element.RenderedElementBase,t.Element.tspan=function(e){this.captureTextNodes=!0,this.base=t.Element.TextElementBase,this.base(e),this.text=e.nodeValue||e.text||"",this.getText=function(){return this.text}},t.Element.tspan.prototype=new t.Element.TextElementBase,t.Element.tref=function(e){this.base=t.Element.TextElementBase,this.base(e),this.getText=function(){var t=this.getHrefAttribute().getDefinition();return null!=t?t.children[0].getText():void 0}},t.Element.tref.prototype=new t.Element.TextElementBase,t.Element.a=function(e){this.base=t.Element.TextElementBase,this.base(e),this.hasText=!0;for(var i=0;i<e.childNodes.length;i++)3!=e.childNodes[i].nodeType&&(this.hasText=!1);this.text=this.hasText?e.childNodes[0].nodeValue:"",this.getText=function(){return this.text},this.baseRenderChildren=this.renderChildren,this.renderChildren=function(e){if(this.hasText){this.baseRenderChildren(e);var i=new t.Property("fontSize",t.Font.Parse(t.ctx.font).fontSize);t.Mouse.checkBoundingBox(this,new t.BoundingBox(this.x,this.y-i.toPixels("y"),this.x+this.measureText(e),this.y))}else{var n=new t.Element.g;n.children=this.children,n.parent=this,n.render(e)}},this.onclick=function(){window.open(this.getHrefAttribute().value)},this.onmousemove=function(){t.ctx.canvas.style.cursor="pointer"}},t.Element.a.prototype=new t.Element.TextElementBase,t.Element.image=function(e){this.base=t.Element.RenderedElementBase,this.base(e);var i=this.getHrefAttribute().value,n=i.match(/\.svg$/);if(t.Images.push(this),this.loaded=!1,n)this.img=t.ajax(i),this.loaded=!0;else{this.img=document.createElement("img");var s=this;this.img.onload=function(){s.loaded=!0},this.img.onerror=function(){"undefined"!=typeof console&&(console.log('ERROR: image "'+i+'" not found'),s.loaded=!0)},this.img.src=i}this.renderChildren=function(e){var i=this.attribute("x").toPixels("x"),s=this.attribute("y").toPixels("y"),a=this.attribute("width").toPixels("x"),r=this.attribute("height").toPixels("y");0!=a&&0!=r&&(e.save(),n?e.drawSvg(this.img,i,s,a,r):(e.translate(i,s),t.AspectRatio(e,this.attribute("preserveAspectRatio").value,a,this.img.width,r,this.img.height,0,0),e.drawImage(this.img,0,0)),e.restore())},this.getBoundingBox=function(){var e=this.attribute("x").toPixels("x"),i=this.attribute("y").toPixels("y"),n=this.attribute("width").toPixels("x"),s=this.attribute("height").toPixels("y");return new t.BoundingBox(e,i,e+n,i+s)}},t.Element.image.prototype=new t.Element.RenderedElementBase,t.Element.g=function(e){this.base=t.Element.RenderedElementBase,this.base(e),this.getBoundingBox=function(){for(var e=new t.BoundingBox,i=0;i<this.children.length;i++)e.addBoundingBox(this.children[i].getBoundingBox());return e}},t.Element.g.prototype=new t.Element.RenderedElementBase,t.Element.symbol=function(e){this.base=t.Element.RenderedElementBase,this.base(e),this.baseSetContext=this.setContext,this.setContext=function(e){if(this.baseSetContext(e),this.attribute("viewBox").hasValue()){var i=t.ToNumberArray(this.attribute("viewBox").value),n=i[0],s=i[1];width=i[2],height=i[3],t.AspectRatio(e,this.attribute("preserveAspectRatio").value,this.attribute("width").toPixels("x"),width,this.attribute("height").toPixels("y"),height,n,s),t.ViewPort.SetCurrent(i[2],i[3])}}},t.Element.symbol.prototype=new t.Element.RenderedElementBase,t.Element.style=function(e){this.base=t.Element.ElementBase,this.base(e);for(var i="",n=0;n<e.childNodes.length;n++)i+=e.childNodes[n].nodeValue;i=i.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,""),i=t.compressSpaces(i);for(var s=i.split("}"),n=0;n<s.length;n++)if(""!=t.trim(s[n]))for(var a=s[n].split("{"),r=a[0].split(","),o=a[1].split(";"),l=0;l<r.length;l++){var h=t.trim(r[l]);if(""!=h){for(var u={},c=0;c<o.length;c++){var f=o[c].indexOf(":"),m=o[c].substr(0,f),d=o[c].substr(f+1,o[c].length-f);null!=m&&null!=d&&(u[t.trim(m)]=new t.Property(t.trim(m),t.trim(d)))}if(t.Styles[h]=u,"@font-face"==h)for(var p=u["font-family"].value.replace(/"/g,""),y=u.src.value.split(","),v=0;v<y.length;v++)if(y[v].indexOf('format("svg")')>0)for(var g=y[v].indexOf("url"),x=y[v].indexOf(")",g),b=y[v].substr(g+5,x-g-6),E=t.parseXml(t.ajax(b)),P=E.getElementsByTagName("font"),w=0;w<P.length;w++){var B=t.CreateElement(P[w]);t.Definitions[p]=B}}}},t.Element.style.prototype=new t.Element.ElementBase,t.Element.use=function(e){this.base=t.Element.RenderedElementBase,this.base(e),this.baseSetContext=this.setContext,this.setContext=function(t){this.baseSetContext(t),this.attribute("x").hasValue()&&t.translate(this.attribute("x").toPixels("x"),0),this.attribute("y").hasValue()&&t.translate(0,this.attribute("y").toPixels("y"))},this.getDefinition=function(){var t=this.getHrefAttribute().getDefinition();return this.attribute("width").hasValue()&&(t.attribute("width",!0).value=this.attribute("width").value),this.attribute("height").hasValue()&&(t.attribute("height",!0).value=this.attribute("height").value),t},this.path=function(t){var e=this.getDefinition();null!=e&&e.path(t)},this.getBoundingBox=function(){var t=this.getDefinition();return null!=t?t.getBoundingBox():void 0},this.renderChildren=function(t){var e=this.getDefinition();if(null!=e){var i=e.parent;e.parent=null,e.render(t),e.parent=i}}},t.Element.use.prototype=new t.Element.RenderedElementBase,t.Element.mask=function(e){this.base=t.Element.ElementBase,this.base(e),this.apply=function(e,i){var n=this.attribute("x").toPixels("x"),s=this.attribute("y").toPixels("y"),a=this.attribute("width").toPixels("x"),r=this.attribute("height").toPixels("y");if(0==a&&0==r){for(var o=new t.BoundingBox,l=0;l<this.children.length;l++)o.addBoundingBox(this.children[l].getBoundingBox());var n=Math.floor(o.x1),s=Math.floor(o.y1),a=Math.floor(o.width()),r=Math.floor(o.height())}var h=i.attribute("mask").value;i.attribute("mask").value="";var u=document.createElement("canvas");u.width=n+a,u.height=s+r;var c=u.getContext("2d");this.renderChildren(c);var f=document.createElement("canvas");f.width=n+a,f.height=s+r;var m=f.getContext("2d");i.render(m),m.globalCompositeOperation="destination-in",m.fillStyle=c.createPattern(u,"no-repeat"),m.fillRect(0,0,n+a,s+r),e.fillStyle=m.createPattern(f,"no-repeat"),e.fillRect(0,0,n+a,s+r),i.attribute("mask").value=h},this.render=function(){}},t.Element.mask.prototype=new t.Element.ElementBase,t.Element.clipPath=function(e){this.base=t.Element.ElementBase,this.base(e),this.apply=function(e){for(var i=0;i<this.children.length;i++){var n=this.children[i];if("undefined"!=typeof n.path){var s=null;n.attribute("transform").hasValue()&&(s=new t.Transform(n.attribute("transform").value),s.apply(e)),n.path(e),e.clip(),s&&s.unapply(e)}}},this.render=function(){}},t.Element.clipPath.prototype=new t.Element.ElementBase,t.Element.filter=function(e){this.base=t.Element.ElementBase,this.base(e),this.apply=function(t,e){var i=e.getBoundingBox(),n=Math.floor(i.x1),s=Math.floor(i.y1),a=Math.floor(i.width()),r=Math.floor(i.height()),o=e.style("filter").value;e.style("filter").value="";for(var l=0,h=0,u=0;u<this.children.length;u++){var c=this.children[u].extraFilterDistance||0;l=Math.max(l,c),h=Math.max(h,c)}var f=document.createElement("canvas");f.width=a+2*l,f.height=r+2*h;var m=f.getContext("2d");m.translate(-n+l,-s+h),e.render(m);for(var u=0;u<this.children.length;u++)this.children[u].apply(m,0,0,a+2*l,r+2*h);t.drawImage(f,0,0,a+2*l,r+2*h,n-l,s-h,a+2*l,r+2*h),e.style("filter",!0).value=o},this.render=function(){}},t.Element.filter.prototype=new t.Element.ElementBase,t.Element.feMorphology=function(e){this.base=t.Element.ElementBase,this.base(e),this.apply=function(){}},t.Element.feMorphology.prototype=new t.Element.ElementBase,t.Element.feColorMatrix=function(e){function i(t,e,i,n,s,a){return t[i*n*4+4*e+a]}function n(t,e,i,n,s,a,r){t[i*n*4+4*e+a]=r}this.base=t.Element.ElementBase,this.base(e),this.apply=function(t,e,s,a,r){for(var o=t.getImageData(0,0,a,r),s=0;r>s;s++)for(var e=0;a>e;e++){var l=i(o.data,e,s,a,r,0),h=i(o.data,e,s,a,r,1),u=i(o.data,e,s,a,r,2),c=(l+h+u)/3;n(o.data,e,s,a,r,0,c),n(o.data,e,s,a,r,1,c),n(o.data,e,s,a,r,2,c)}t.clearRect(0,0,a,r),t.putImageData(o,0,0)}},t.Element.feColorMatrix.prototype=new t.Element.ElementBase,t.Element.feGaussianBlur=function(e){this.base=t.Element.ElementBase,this.base(e),this.blurRadius=Math.floor(this.attribute("stdDeviation").numValue()),this.extraFilterDistance=this.blurRadius,this.apply=function(e,i,n,s,a){return"undefined"==typeof stackBlurCanvasRGBA?void("undefined"!=typeof console&&console.log("ERROR: StackBlur.js must be included for blur to work")):(e.canvas.id=t.UniqueId(),e.canvas.style.display="none",document.body.appendChild(e.canvas),stackBlurCanvasRGBA(e.canvas.id,i,n,s,a,this.blurRadius),void document.body.removeChild(e.canvas))}},t.Element.feGaussianBlur.prototype=new t.Element.ElementBase,t.Element.title=function(){},t.Element.title.prototype=new t.Element.ElementBase,t.Element.desc=function(){},t.Element.desc.prototype=new t.Element.ElementBase,t.Element.MISSING=function(t){"undefined"!=typeof console&&console.log("ERROR: Element '"+t.nodeName+"' not yet implemented.")},t.Element.MISSING.prototype=new t.Element.ElementBase,t.CreateElement=function(e){var i=e.nodeName.replace(/^[^:]+:/,"");i=i.replace(/\-/g,"");var n=null;return n="undefined"!=typeof t.Element[i]?new t.Element[i](e):new t.Element.MISSING(e),n.type=e.nodeName,n},t.load=function(e,i){t.loadXml(e,t.ajax(i))},t.loadXml=function(e,i){t.loadXmlDoc(e,t.parseXml(i))},t.loadXmlDoc=function(e,i){t.init(e);var n=function(t){for(var i=e.canvas;i;)t.x-=i.offsetLeft,t.y-=i.offsetTop,i=i.offsetParent;return window.scrollX&&(t.x+=window.scrollX),window.scrollY&&(t.y+=window.scrollY),t};1!=t.opts.ignoreMouse&&(e.canvas.onclick=function(e){var i=n(new t.Point(null!=e?e.clientX:event.clientX,null!=e?e.clientY:event.clientY));t.Mouse.onclick(i.x,i.y)},e.canvas.onmousemove=function(e){var i=n(new t.Point(null!=e?e.clientX:event.clientX,null!=e?e.clientY:event.clientY));t.Mouse.onmousemove(i.x,i.y)});var s=t.CreateElement(i.documentElement);s.root=!0;var a=!0,r=function(){t.ViewPort.Clear(),e.canvas.parentNode&&t.ViewPort.SetCurrent(e.canvas.parentNode.clientWidth,e.canvas.parentNode.clientHeight),1!=t.opts.ignoreDimensions&&(s.style("width").hasValue()&&(e.canvas.width=s.style("width").toPixels("x"),e.canvas.style.width=e.canvas.width+"px"),s.style("height").hasValue()&&(e.canvas.height=s.style("height").toPixels("y"),e.canvas.style.height=e.canvas.height+"px"));var n=e.canvas.clientWidth||e.canvas.width,r=e.canvas.clientHeight||e.canvas.height;if(1==t.opts.ignoreDimensions&&s.style("width").hasValue()&&s.style("height").hasValue()&&(n=s.style("width").toPixels("x"),r=s.style("height").toPixels("y")),t.ViewPort.SetCurrent(n,r),null!=t.opts.offsetX&&(s.attribute("x",!0).value=t.opts.offsetX),null!=t.opts.offsetY&&(s.attribute("y",!0).value=t.opts.offsetY),null!=t.opts.scaleWidth&&null!=t.opts.scaleHeight){var o=1,l=1,h=t.ToNumberArray(s.attribute("viewBox").value);s.attribute("width").hasValue()?o=s.attribute("width").toPixels("x")/t.opts.scaleWidth:isNaN(h[2])||(o=h[2]/t.opts.scaleWidth),s.attribute("height").hasValue()?l=s.attribute("height").toPixels("y")/t.opts.scaleHeight:isNaN(h[3])||(l=h[3]/t.opts.scaleHeight),s.attribute("width",!0).value=t.opts.scaleWidth,s.attribute("height",!0).value=t.opts.scaleHeight,s.attribute("viewBox",!0).value="0 0 "+n*o+" "+r*l,s.attribute("preserveAspectRatio",!0).value="none"}1!=t.opts.ignoreClear&&e.clearRect(0,0,n,r),s.render(e),a&&(a=!1,"function"==typeof t.opts.renderCallback&&t.opts.renderCallback(i))},o=!0;t.ImagesLoaded()&&(o=!1,r()),t.intervalID=setInterval(function(){var e=!1;if(o&&t.ImagesLoaded()&&(o=!1,e=!0),1!=t.opts.ignoreMouse&&(e|=t.Mouse.hasEvents()),1!=t.opts.ignoreAnimation)for(var i=0;i<t.Animations.length;i++)e|=t.Animations[i].update(1e3/t.FRAMERATE);"function"==typeof t.opts.forceRedraw&&1==t.opts.forceRedraw()&&(e=!0),e&&(r(),t.Mouse.runEvents())},1e3/t.FRAMERATE)},t.stop=function(){t.intervalID&&clearInterval(t.intervalID)},t.Mouse=new function(){this.events=[],this.hasEvents=function(){return 0!=this.events.length},this.onclick=function(t,e){this.events.push({type:"onclick",x:t,y:e,run:function(t){t.onclick&&t.onclick()}})},this.onmousemove=function(t,e){this.events.push({type:"onmousemove",x:t,y:e,run:function(t){t.onmousemove&&t.onmousemove()}})},this.eventElements=[],this.checkPath=function(t,e){for(var i=0;i<this.events.length;i++){var n=this.events[i];e.isPointInPath&&e.isPointInPath(n.x,n.y)&&(this.eventElements[i]=t)}},this.checkBoundingBox=function(t,e){for(var i=0;i<this.events.length;i++){var n=this.events[i];e.isPointInBox(n.x,n.y)&&(this.eventElements[i]=t)}},this.runEvents=function(){t.ctx.canvas.style.cursor="";for(var e=0;e<this.events.length;e++)for(var i=this.events[e],n=this.eventElements[e];n;)i.run(n),n=n.parent;this.events=[],this.eventElements=[]}},t}this.canvg=function(e,i,n){if(null!=e||null!=i||null!=n){n=n||{},"string"==typeof e&&(e=document.getElementById(e)),null!=e.svg&&e.svg.stop();var s=t();(1!=e.childNodes.length||"OBJECT"!=e.childNodes[0].nodeName)&&(e.svg=s),s.opts=n;var a=e.getContext("2d");"undefined"!=typeof i.documentElement?s.loadXmlDoc(a,i):"<"==i.substr(0,1)?s.loadXml(a,i):s.load(a,i)}else for(var r=document.getElementsByTagName("svg"),o=0;o<r.length;o++){var l=r[o],h=document.createElement("canvas");h.width=l.clientWidth,h.height=l.clientHeight,l.parentNode.insertBefore(h,l),l.parentNode.removeChild(l);var u=document.createElement("div");u.appendChild(l),canvg(h,u.innerHTML)}}}(),"undefined"!=typeof CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.drawSvg=function(t,e,i,n,s){canvg(this.canvas,t,{ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:e,offsetY:i,scaleWidth:n,scaleHeight:s})});
!function(t){"use strict";var e,o=t.Uint8Array,n=t.HTMLCanvasElement,i=n&&n.prototype,a=/\s*;\s*base64\s*(?:;|$)/i,s="toDataURL",r=function(t){for(var n,i,a,s=t.length,r=new o(s/4*3|0),l=0,f=0,b=[0,0],d=0,u=0;s--;)i=t.charCodeAt(l++),n=e[i-43],255!==n&&n!==a&&(b[1]=b[0],b[0]=i,u=u<<6|n,d++,4===d&&(r[f++]=u>>>16,61!==b[1]&&(r[f++]=u>>>8),61!==b[0]&&(r[f++]=u),d=0));return r};o&&(e=new o([62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51])),n&&!i.toBlob&&(i.toBlob=function(t,e){if(e||(e="image/png"),this.mozGetAsFile)return void t(this.mozGetAsFile("canvas",e));var n,i=Array.prototype.slice.call(arguments,1),l=this[s].apply(this,i),f=l.indexOf(","),b=l.substring(f+1),d=a.test(l.substring(0,f));Blob.fake?(n=new Blob,n.encoding=d?"base64":"URI",n.data=b,n.size=b.length):o&&(n=d?new Blob([r(b)],{type:e}):new Blob([decodeURIComponent(b)],{type:e})),t(n)},i.toBlobHD=i.toDataURLHD?function(){s="toDataURLHD";var t=this.toBlob();return s="toDataURL",t}:i.toBlob)}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content||this);
!function(n){"use strict";var t=n.module("martVisualEnrichment.controllers");t.controller("GraphCtrl",["$scope","$timeout",function(n,t){var e=null;n.nodes=n.mvTab.nodes,n.edges=n.mvTab.edges,n.$watch(function(n){return n.mvTab.pattern},function(){e&&t.cancel(e),e=t(function(){n.search=n.mvTab.pattern},500)})}])}(angular);
!function(e,t){"use strict";function n(e){e=t.select(e);var n=window.Blob||window.WebKitBlob||window.MozBlob,r=e.select("svg").attr("version",1.1).attr("xmlns","http://www.w3.org/2000/svg").node().parentNode.innerHTML;if(i){var a="data:image/svg+xml;utf8,"+r;window.open(a,"_blank")}else{var o=new n([r],{type:"data:image/svg+xml"});saveAs(o,"enrichment-network.svg")}}function r(e){var t=JSON.stringify(e);if(i){var n="data:application/json;utf8,"+t;window.open(n,"_blank")}else{var r=new Blob([t],{type:"data:application/json;charset=utf-8"});saveAs(r,"enrichment-network.json")}}function a(e){for(var t={},n=0,r=e.edges.length;r>n;++n){var a=e.edges[n];(t[a.target.id]||(t[a.target.id]=[])).push(a.source.id)}var o="",s="	";for(var c in t){var l=e.nodes.filter(function(e){return e.id===c}),d=l[0];o+=[c,d.description,t[c].join(","),d.pvalue].join(s)+"\n"}if(i){var u="data:application/json;utf8,"+o;window.open(u,"_blank")}else{var f=new Blob([o],{type:"data:text/plain;charset=utf-8"});saveAs(f,"enrichment-network.tsv")}}function o(e){e=t.select(e);var n=(t.select("body").append("canvas").attr("id","canvas").style("display","none"),e.select("svg").node().parentNode.innerHTML);canvg("canvas",n);var r=document.getElementById("canvas"),a=-1!=navigator.userAgent.indexOf("Safari")&&-1==navigator.userAgent.indexOf("Chrome");if(a){var o=r.toDataURL("image/png;base64");window.open(o,"download")}else r.toBlob(function(e){saveAs(e,"enrichment-network.png")},"image/png");t.select("#canvas").remove()}var i=-1!=navigator.userAgent.indexOf("Safari")&&-1==navigator.userAgent.indexOf("Chrome"),s=function(e){return function(t,n,r){function a(e){return k(e.id)}function o(e){return"term"===e.type}function i(e){return parseFloat(e.pvalue)}function s(){D.attr("transform","translate("+e.event.translate+")scale("+e.event.scale+")")}function c(){e.event.sourceEvent.stopPropagation(),e.select(this).classed("dragging",!0)}function l(){e.select(this).classed("dragging",!1)}function d(e,t){var n=g(e,t);return n}function u(e,t){for(var n=0,r=t.length;r>n;++n)f(e,t[n])}function f(e,t){for(var n,r,a=t.source,o=t.target,i=0,s=e.length;s>i&&("string"==typeof a||"string"==typeof o);)n=e[i],r=n.id,a===r?t.source=a=n:o===r&&(t.target=o=n),++i}function g(e,t){for(var n,r,a,o=[],i=!1,s=0,c=0,l=e.length;l>c;++c){n=e[c];for(var d=0+s,u=t.length;u>d;++d)r=t[d],r.target===n&&-1===o.indexOf(r.target)?(o.push(r.source),i=!0):r.source===n&&-1===o.indexOf(r.source)&&(o.push(r.target),i=!0),i&&(i=!1,a=t[s],t[s]=r,t[d]=a,++s)}return[o,s>0?t.slice(0,s):[]]}function p(e){var t=M[1]-M[0];return e.r=e.pr=0===t?13:30*(1-(parseFloat(e.pvalue)-M[0])/(M[1]-M[0]))+13}function v(e,t){var n=e.length,r=360/n*Math.PI/180,a=r,o=t.centre||[0,0],i=t.radius||50,s=t.offset||20;e.forEach(function(e){e.x=o[0]+i*Math.cos(a)+(-s+2*Math.random()*s),e.y=o[1]+i*Math.sin(a)+(-s+2*Math.random()*s),a+=r})}function h(e){return e.x}function m(e){return e.y}function w(){I.attr({cx:h,cy:m}),T.attr({x1:function(e){return e.source.x},y1:function(e){return e.source.y},x2:function(e){return e.target.x},y2:function(e){return e.target.y}}),R.attr("transform",function(e){return"translate("+e.x+","+e.y+")"})}function y(){H.nodes().forEach(function(e){e.fixed=!0})}function x(t){if(t.pr===t.r){var n=e.select(this);n.transition().attr("r",t.r=1.5*t.r),n.classed("node-selected",!0)}}function b(t){var n=e.select(this);e.select(this).transition().attr("r",t.r=t.pr),n.classed("node-selected",!1)}function k(e){return"e"+e.replace(/[:;,\.]*/g,"")}r=r||{};var A=e.select(r.container),E=r.showNth||5,_=r.margin||{top:20,right:30,bottom:20,left:30},j=(r.width||1200)-_.right-_.left,O=(r.height||800)-_.top-_.bottom;u(t,n);var N=t.filter(o).splice(0,E),M=e.extent(N,i),$=d(N,n),B=$[0];n=$[1];var S=Object.keys(B[0]),z=Object.keys(N[0]).filter(function(e){return"$"!==e[0]&&"_"!==e[0]});$=null;var C=e.behavior.zoom().scaleExtent([0,4]).on("zoom",s),P=A.append("svg:svg").attr({title:"test2",version:1.1,xmlns:"http://www.w3.org/2000/svg",width:j+_.right+_.left,height:O+_.top+_.bottom}).style("cursor","pointer").append("svg:g").attr("transform",["translate(",_.left,",",_.top,")"].join("")).call(C).on("mousedown.zoom",null),q=(P.append("rect").attr("width",j).attr("height",O).style("fill","none").style("pointer-events","all"),e.tip().attr("class","d3-tip").offset([-10,0]).html(function(e){var t="gene"===e.type?S:z;return t.reduce(function(t,n){return t+'<strong class="d3-tip-prop">'+n+"</strong>: "+e[n]+"<br/>"},"")})),D=P.append("svg:g").attr({"class":"enrichment-vis",transform:["translate(",_.left,",",_.top,")"].join("")}),F=3.5*p({pvalue:M[0]});v(N,{centre:[j/2,O/2],radius:5,offset:5}),v(B,{centre:[j/2,O/2],radius:F,offset:5});var H=e.layout.force().size([j,O]).linkDistance(F).nodes(N.concat(B)).links(n).gravity(.4).charge(function(e){return"gene"===e.type?-400:-100*e.weight}).on("tick",w).on("end",y).start().alpha(.02),L=H.drag().on("dragstart",c).on("dragend",l);t=H.nodes();var T=D.selectAll(".line").data(n).enter().append("line").attr("class","line").style({stroke:"#556270","shape-rendering":"geometricPrecision"}).attr("id",function(e,t){return e.index=t,"link"+t});D.selectAll(".term").data(N).enter().append("circle").attr("r",p).attr("id",a).classed({term:!0,node:!0}).style({opacity:.9,fill:"#4ECDC4",stroke:"#4194cd","stroke-width":2}).call(L),D.selectAll(".gene").data(B).enter().append("circle").attr("r",function(e){return e.r=e.pr=10}).attr("id",a).classed({gene:!0,node:!0}).style({opacity:.9,fill:"#C7F464",stroke:"#67c822","stroke-width":2}).call(L).call(q);var I=D.selectAll(".node");I.on("mouseover.node.tip",q.show).on("mouseout.node.tip",q.hide).on("mouseover.node.transition",x).on("mouseout.node.transition",b);var K=D.append("svg:g").attr("class","node-text");K.selectAll(".term-label").data(N).enter().append("svg:g").append("svg:text").attr("class","term-label").style({"text-anchor":"middle","shape-rendering":"crispEdges"}).text(function(e){return e.description.length>28?e.description.substr(0,25)+"...":e.description}),K.selectAll(".gene-label").data(B).enter().append("svg:g").append("svg:text").attr("class","gene-label").style({"text-anchor":"middle","shape-rendering":"crispEdges","font-size":"0.7em"}).text(function(e){return e.id});var R=K.selectAll("g");return{hn:[],remove:function(){D.remove(),A.select("svg").remove()},highlightNode:function(e){var t=document.querySelector("#"+k(e));t&&(x.call(t,t.__data__),this.hn.push(t))},restoreNodes:function(){this.hn.forEach(function(e){b.call(e,e.__data__)}),this.hn=[]}}}}.call(this,t);e.module("martVisualEnrichment.directives").directive("mvGraph",["$rootScope","progressState","$timeout",function(t,i,c){function l(e,l){var d=null;c(function(){var i=l.find("div").eq(0);d=s(e.nodes,e.edges,{container:i[0],width:l.width(),height:l.height()}),l.find(".save-png").on("click",function(){o(l.find("div").eq(0)[0])}),l.find(".save-svg").on("click",function(){n(l.find("div").eq(0)[0])}),l.find(".save-json").on("click",function(){r({nodes:e.nodes,edges:e.edges})}),l.find(".save-tsv").on("click",function(){a({nodes:e.nodes,edges:e.edges})});var c=t.$on("term.mouseover",function(e,t){d.highlightNode(t.id)}),u=t.$on("term.mouseout",function(e,t){d.restoreNodes(t.id)});e.$on("$destroy",function(){d.remove(),c(),u()})},200),i.setState(i.states.NETWORK);var u=!0;e.$watch(function(e){return e.filterPattern},function(e,t){u&&(u=!1)})}return{restrict:"E",replace:!0,templateUrl:"mart-visual-enrichment/app/partials/vis.html",scope:{nodes:"=nodes",edges:"=edges",filterPattern:"="},compile:function(t){var n=e.element(window).prop("innerHeight");return t.css("height",n+"px"),l}}}])}(angular,d3);
!function(t){"use strict";t.module("martVisualEnrichment.directives").directive("mvResultsTable",["$rootScope","progressState",function(e,r){return{restrict:"E",templateUrl:"mart-visual-enrichment/app/partials/table-of-results.html",link:function(a,n){function o(r){return function(a){var n=null,o=a.target;if("TD"===o.tagName?n=o.parentNode:"TR"===o.tagName&&(n=o),n){var s=t.element(o);e.$emit(r,s.scope().term)}}}n.on("mouseover",o("term.mouseover")),n.on("mouseout",o("term.mouseout")),r.setState(r.states.TABLE)}}}])}(angular);